<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø³Ø­Ø±ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bottle-width: 70px;
            --bottle-height: 200px;
            --liquid-unit-height: 40px;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #1f2937 0%, #374151 50%, #111827 100%);
        }
        
        .glass-effect {
            backdrop-filter: blur(12px) saturate(150%);
            -webkit-backdrop-filter: blur(12px) saturate(150%);
            background: rgba(31, 41, 55, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .neon-glow {
            transition: all 0.3s ease;
        }
        .neon-glow:hover {
            filter: drop-shadow(0 0 15px currentColor);
        }
        .neon-glow-permanent {
            filter: drop-shadow(0 0 10px currentColor);
        }
        
        .bottle {
            width: var(--bottle-width);
            height: var(--bottle-height);
            border: 4px solid rgba(255, 255, 255, 0.6);
            border-top: none;
            border-radius: 0 0 30px 30px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: bottom center;
        }
        .bottle::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 50%;
            height: 20px;
            border: 4px solid rgba(255, 255, 255, 0.6);
            border-bottom: none;
            border-radius: 15px 15px 0 0;
        }
        .bottle.selected {
            transform: translateY(-20px) scale(1.05);
            box-shadow: 0 0 30px #3b82f6;
        }

        .liquid-stack {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            flex-direction: column-reverse;
            border-radius: 0 0 26px 26px;
            overflow: hidden;
        }
        .liquid-unit {
            height: var(--liquid-unit-height);
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            transition: background-color 0.5s;
        }
        
        .pour-animation {
            animation: pour 0.8s ease-in-out;
        }
        @keyframes pour {
            0% { transform: translateY(-20px) rotate(0deg); }
            40% { transform: translateY(-50px) rotate(80deg); }
            60% { transform: translateY(-50px) rotate(80deg); }
            100% { transform: translateY(-20px) rotate(0deg); }
        }

        .success-sparkle {
            animation: sparkle-burst 1s ease-out forwards;
        }
        @keyframes sparkle-burst {
            from { transform: scale(0); opacity: 1; }
            to { transform: scale(2); opacity: 0; }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            :root {
                --bottle-width: 60px;
                --bottle-height: 180px;
                --liquid-unit-height: 36px;
            }
        }
        @media (max-width: 480px) {
            :root {
                --bottle-width: 45px;
                --bottle-height: 150px;
                --liquid-unit-height: 30px;
            }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white overflow-x-hidden">
    <div id="root" class="relative z-10 p-4 sm:p-6">
        
        <!-- Header -->
        <header class="flex justify-between items-center p-4 glass-effect rounded-2xl mb-6">
            <h1 class="text-xl sm:text-3xl font-bold">ğŸ§ª Ù…Ø®ØªØ¨Ø± Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø³Ø­Ø±ÙŠ</h1>
            <div class="flex items-center gap-2 sm:gap-4">
                <div class="flex items-center gap-2 bg-blue-500/50 px-3 py-1.5 rounded-full neon-glow text-blue-300">
                    ğŸ’ <span id="gems">0</span>
                </div>
                <div class="flex items-center gap-2 bg-yellow-500/50 px-3 py-1.5 rounded-full neon-glow text-yellow-300">
                    â­ <span id="stars">0</span>
                </div>
                <button id="soundToggle" class="bg-purple-500/50 p-2 rounded-full transition-all hover:scale-110 neon-glow text-purple-300">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path id="soundIconPath" d="M10 2a1 1 0 00-1 1v14a1 1 0 002 0V3a1 1 0 00-1-1zM5 6a1 1 0 00-1 1v6a1 1 0 002 0V7a1 1 0 00-1-1zm10 0a1 1 0 00-1 1v6a1 1 0 002 0V7a1 1 0 00-1-1z"/></svg>
                </button>
            </div>
        </header>

        <!-- Game Container -->
        <main id="gameContainer" class="container mx-auto">
            <!-- Level Selection Screen -->
            <div id="levelSelection">
                <!-- Worlds will be generated here -->
            </div>

            <!-- Game Screen -->
            <div id="gameScreen" class="hidden">
                <!-- Mission Info -->
                <div class="glass-effect rounded-2xl p-4 sm:p-6 mb-6">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                        <div class="text-center md:text-right">
                            <h2 class="text-lg text-gray-300">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ <span id="currentLevel">1</span>: Ø£ÙƒÙ…Ù„ Ø§Ù„ÙƒÙ„Ù…Ø©</h2>
                            <div class="flex items-center justify-center md:justify-start gap-3">
                                <p id="targetWord" class="text-4xl sm:text-5xl font-extrabold tracking-widest"></p>
                                <button id="speakBtn" class="text-blue-300 hover:text-blue-400 neon-glow">
                                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z" clip-rule="evenodd" /></svg>
                                </button>
                            </div>
                        </div>
                        <div id="timerContainer" class="text-center bg-gray-900/50 rounded-2xl px-6 py-3 border-2 border-red-500 neon-glow-permanent text-red-400">
                            <div class="text-4xl font-bold" id="timer">120</div>
                            <div class="text-sm">Ø«Ø§Ù†ÙŠØ© Ù…ØªØ¨Ù‚ÙŠØ©</div>
                        </div>
                        <div class="flex gap-2">
                            <button id="resetBtn" class="bg-red-500/80 px-4 py-2 rounded-xl font-bold hover:bg-red-500 neon-glow text-red-100">ğŸ”„</button>
                            <button id="hintBtn" class="bg-yellow-500/80 px-4 py-2 rounded-xl font-bold hover:bg-yellow-500 neon-glow text-yellow-100">ğŸ’¡</button>
                            <button id="backBtn" class="bg-gray-500/80 px-4 py-2 rounded-xl font-bold hover:bg-gray-500 neon-glow text-gray-100">â¬…ï¸</button>
                        </div>
                    </div>
                </div>

                <!-- Bottles Area -->
                <div id="bottlesArea" class="flex flex-wrap justify-center items-end gap-x-4 gap-y-10 min-h-[300px]">
                    <!-- Bottles will be generated here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="modalContainer" class="fixed inset-0 z-50 flex items-center justify-center transition-opacity duration-300 bg-black/70 opacity-0 pointer-events-none">
        
        <!-- Level Start Modal -->
        <div id="levelStartModal" class="hidden glass-effect rounded-2xl p-8 text-center max-w-lg mx-4 transform scale-95 transition-transform duration-300">
            <h2 class="text-2xl text-gray-300 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„ÙŠÙˆÙ…</h2>
            <p id="startWord" class="text-6xl font-extrabold text-yellow-300 mb-4 neon-glow-permanent"></p>
            <p id="startMeaning" class="text-xl mb-4"></p>
            <p id="startSentence" class="text-lg bg-gray-900/50 p-4 rounded-xl mb-6"></p>
            <button id="startLevelBtn" class="w-full bg-gradient-to-r from-green-500 to-blue-500 px-8 py-4 rounded-full font-bold text-xl hover:scale-105 transition-all neon-glow">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨!</button>
        </div>
        
        <!-- Success Modal -->
        <div id="successModal" class="hidden glass-effect rounded-2xl p-8 text-center max-w-lg mx-4 transform scale-95 transition-transform duration-300">
            <div class="relative">
                <div class="absolute -inset-4 success-sparkle text-5xl">âœ¨</div>
                <h2 class="text-6xl font-extrabold text-green-400 mb-4">Ù…Ù…ØªØ§Ø²!</h2>
            </div>
            <p class="text-xl mb-6">Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª ÙƒÙ„Ù…Ø©: <span id="completedWord" class="font-bold text-yellow-300"></span></p>
            <div class="flex justify-center gap-4 mb-8">
                <div class="bg-blue-500/30 px-6 py-3 rounded-xl">
                    <div class="text-4xl">ğŸ’</div>
                    <div id="gemsEarned" class="font-bold text-lg">+15</div>
                </div>
                <div class="bg-yellow-500/30 px-6 py-3 rounded-xl">
                    <div class="text-4xl">â­</div>
                    <div id="starsEarned" class="font-bold text-lg">+3</div>
                </div>
            </div>
            <button id="nextLevelBtn" class="w-full bg-gradient-to-r from-green-500 to-blue-500 px-8 py-4 rounded-full font-bold text-xl hover:scale-105 transition-all neon-glow">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
        </div>

        <!-- Game Over Modal -->
        <div id="gameOverModal" class="hidden glass-effect rounded-2xl p-8 text-center max-w-lg mx-4 transform scale-95 transition-transform duration-300">
            <h2 class="text-6xl font-extrabold text-red-400 mb-4">Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!</h2>
            <p class="text-xl mb-8">Ù„Ø§ Ø¨Ø£Ø³ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„ÙƒÙ„Ù…Ø©.</p>
            <button id="retryBtn" class="w-full bg-gradient-to-r from-yellow-500 to-orange-500 px-8 py-4 rounded-full font-bold text-xl hover:scale-105 transition-all neon-glow">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ğŸ”</button>
        </div>

    </div>

    <script>
    class ProfessionalColorSortGame {
        constructor() {
            this.DOM = {
                root: document.getElementById('root'),
                gems: document.getElementById('gems'),
                stars: document.getElementById('stars'),
                currentLevelDisplay: document.getElementById('currentLevel'),
                levelSelection: document.getElementById('levelSelection'),
                gameScreen: document.getElementById('gameScreen'),
                targetWord: document.getElementById('targetWord'),
                timer: document.getElementById('timer'),
                bottlesArea: document.getElementById('bottlesArea'),
                modalContainer: document.getElementById('modalContainer'),
                levelStartModal: document.getElementById('levelStartModal'),
                successModal: document.getElementById('successModal'),
                gameOverModal: document.getElementById('gameOverModal'),
                soundToggle: document.getElementById('soundToggle'),
                soundIconPath: document.getElementById('soundIconPath'),
                speakBtn: document.getElementById('speakBtn'),
                resetBtn: document.getElementById('resetBtn'),
                hintBtn: document.getElementById('hintBtn'),
                backBtn: document.getElementById('backBtn'),
                startLevelBtn: document.getElementById('startLevelBtn'),
                nextLevelBtn: document.getElementById('nextLevelBtn'),
                retryBtn: document.getElementById('retryBtn'),
            };

            this.gameState = {
                currentLevel: null,
                gems: 0,
                stars: 0,
                unlockedWorlds: ['Ø­ÙŠÙˆØ§Ù†Ø§Øª'],
                completedLevels: [],
                timeLeft: 50,
                timer: null,
                selectedBottleIndex: null,
                bottleContents: [],
                isPouring: false,
            };
            
            this.config = {
                bottleCapacity: 4,
                baseLevelTime: 50,
                hintCost: 25,
            };

            this.colorMap = {
                'Ø£': '#ef4444', 'Ø¨': '#8b5cf6', 'Øª': '#f97316', 'Ø«': '#a78bfa', 'Ø¬': '#10b981', 
                'Ø­': '#f43f5e', 'Ø®': '#16a34a', 'Ø¯': '#d946ef', 'Ø°': '#fbbf24', 'Ø±': '#64748b', 
                'Ø²': '#3b82f6', 'Ø³': '#06b6d4', 'Ø´': '#0891b2', 'Øµ': '#f59e0b', 'Ø¶': '#ca8a04', 
                'Ø·': '#65a30d', 'Ø¸': '#84cc16', 'Ø¹': '#6366f1', 'Øº': '#4f46e5', 'Ù': '#ec4899', 
                'Ù‚': '#8b5a2b', 'Ùƒ': '#eab308', 'Ù„': '#22c55e', 'Ù…': '#a855f7', 'Ù†': '#6366f1', 
                'Ù‡': '#f472b6', 'Ùˆ': '#ec4899', 'ÙŠ': '#14b8a6',
            };

            this.levels = {
    'Ø­ÙŠÙˆØ§Ù†Ø§Øª': [
        { word: 'Ø£Ø³Ø¯', meaning: 'Ù…Ù„Ùƒ Ø§Ù„ØºØ§Ø¨Ø©', sentence: 'Ø§Ù„Ø£Ø³Ø¯ Ø­ÙŠÙˆØ§Ù† Ù‚ÙˆÙŠ.' },
        { word: 'Ø¨Ø­Ø±', meaning: 'Ù…ÙŠØ§Ù‡ Ù…Ø§Ù„Ø­Ø© ÙˆØ§Ø³Ø¹Ø©', sentence: 'Ù†Ø³Ø¨Ø­ ÙÙŠ Ø§Ù„Ø¨Ø­Ø± ØµÙŠÙÙ‹Ø§.' },
        { word: 'Ù‚Ø·', meaning: 'Ø­ÙŠÙˆØ§Ù† Ø£Ù„ÙŠÙ Ù„Ø·ÙŠÙ', sentence: 'ÙŠØ­Ø¨ Ø§Ù„Ù‚Ø· Ø§Ù„Ù„Ø¹Ø¨ Ø¨Ø§Ù„ÙƒØ±Ø©.'},
        { word: 'ÙÙŠÙ„', meaning: 'Ø­ÙŠÙˆØ§Ù† Ø¶Ø®Ù… Ø¨Ø®Ø±Ø·ÙˆÙ… Ø·ÙˆÙŠÙ„', sentence: 'ÙŠØ¹ÙŠØ´ Ø§Ù„ÙÙŠÙ„ ÙÙŠ Ø£ÙØ±ÙŠÙ‚ÙŠØ§.'},
        { word: 'Ù†Ù…Ø±', meaning: 'Ø­ÙŠÙˆØ§Ù† Ù…ÙØªØ±Ø³ ÙˆÙ…Ø®Ø·Ø·', sentence: 'Ø§Ù„Ù†Ù…Ø± Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ù‹Ø§.'}
    ],
    'Ø·Ø¨ÙŠØ¹Ø©': [
        { word: 'Ø´Ù…Ø³', meaning: 'Ù†Ø¬Ù… ÙŠØ¶ÙŠØ¡ Ø§Ù„Ù†Ù‡Ø§Ø±', sentence: 'ØªØ´Ø±Ù‚ Ø§Ù„Ø´Ù…Ø³ ÙƒÙ„ ØµØ¨Ø§Ø­.' },
        { word: 'Ù‚Ù…Ø±', meaning: 'ÙŠØ¶ÙŠØ¡ Ø§Ù„Ø³Ù…Ø§Ø¡ Ù„ÙŠÙ„Ø§Ù‹', sentence: 'Ø§Ù„Ù‚Ù…Ø± Ø¬Ù…ÙŠÙ„ ÙÙŠ Ù„ÙŠÙ„Ø© ØµØ§ÙÙŠØ©.' },
        { word: 'Ù†Ù‡Ø±', meaning: 'Ù…Ø¬Ø±Ù‰ Ù…Ø§Ø¡ Ø¹Ø°Ø¨', sentence: 'ØªØ¬Ø±ÙŠ Ø§Ù„Ø³ÙÙ† ÙÙŠ Ø§Ù„Ù†Ù‡Ø±.' },
        { word: 'Ø²Ù‡Ø±', meaning: 'Ø¬Ø²Ø¡ Ø§Ù„Ù†Ø¨Ø§Øª Ø§Ù„Ù…Ù„ÙˆÙ†', sentence: 'Ø±Ø§Ø¦Ø­Ø© Ø§Ù„Ø²Ù‡Ø± Ø¹Ø·Ø±Ø©.'},
        { word: 'ØºÙŠÙ…', meaning: 'Ø¨Ø®Ø§Ø± Ù…Ø§Ø¡ ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡', sentence: 'Ø§Ù„Ø³Ù…Ø§Ø¡ Ù…Ù„ÙŠØ¦Ø© Ø¨Ø§Ù„ØºÙŠÙ… Ø§Ù„ÙŠÙˆÙ….'}
    ],
    'Ø£Ø´ÙŠØ§Ø¡': [
        { word: 'Ø¨Ø§Ø¨', meaning: 'Ù…Ø¯Ø®Ù„ Ø¥Ù„Ù‰ ØºØ±ÙØ© Ø£Ùˆ Ù…Ø¨Ù†Ù‰', sentence: 'Ø£ØºÙ„Ù‚ Ø§Ù„Ø¨Ø§Ø¨ Ù…Ù† ÙØ¶Ù„Ùƒ.' },
        { word: 'ÙƒØªØ§Ø¨', meaning: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£ÙˆØ±Ø§Ù‚ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©', sentence: 'Ø£Ø­Ø¨ Ù‚Ø±Ø§Ø¡Ø© ÙƒÙ„ ÙƒØªØ§Ø¨ Ø¬Ø¯ÙŠØ¯.'},
        { word: 'Ù‚Ù„Ù…', meaning: 'Ø£Ø¯Ø§Ø© Ù„Ù„ÙƒØªØ§Ø¨Ø©', sentence: 'Ø£ÙƒØªØ¨ Ø§Ù„Ø¯Ø±Ø³ Ø¨Ø§Ù„Ù‚Ù„Ù….'},
        { word: 'Ø¨ÙŠØª', meaning: 'Ù…ÙƒØ§Ù† Ù†Ø¹ÙŠØ´ ÙÙŠÙ‡', sentence: 'Ø¨ÙŠØªÙ†Ø§ Ø¯Ø§ÙØ¦ ÙˆØ¬Ù…ÙŠÙ„.'},
        { word: 'ÙƒØ±Ø³ÙŠ', meaning: 'Ù†Ø¬Ù„Ø³ Ø¹Ù„ÙŠÙ‡ Ù„Ù„Ø±Ø§Ø­Ø©', sentence: 'Ù‡Ø°Ø§ ÙƒØ±Ø³ÙŠ Ù…Ø±ÙŠØ­ Ø¬Ø¯Ù‹Ø§.'}
    ],
    'Ø·Ø¹Ø§Ù… ÙˆÙ…Ø·Ø¨Ø®': [
        { word: 'Ø®Ø¨Ø²', meaning: 'Ø·Ø¹Ø§Ù… Ø£Ø³Ø§Ø³ÙŠ Ù…Ù† Ø§Ù„Ø·Ø­ÙŠÙ†', sentence: 'Ø£ÙƒÙ„Øª Ù‚Ø·Ø¹Ø© Ø®Ø¨Ø² Ù„Ø°ÙŠØ°Ø©.' },
        { word: 'Ù…Ø§Ø¡', meaning: 'Ø³Ø§Ø¦Ù„ Ø´ÙØ§Ù Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„Ø­ÙŠØ§Ø©', sentence: 'Ø£Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ Ø¹Ù†Ø¯Ù…Ø§ Ø£Ø´Ø¹Ø± Ø¨Ø§Ù„Ø¹Ø·Ø´.' },
        { word: 'ØªÙØ§Ø­', meaning: 'ÙØ§ÙƒÙ‡Ø© Ø­Ù…Ø±Ø§Ø¡ Ø£Ùˆ Ø®Ø¶Ø±Ø§Ø¡', sentence: 'Ø§Ù„ØªÙØ§Ø­ ÙØ§ÙƒÙ‡Ø© ØµØ­ÙŠØ© Ø¬Ø¯Ù‹Ø§.' },
        { word: 'ØµØ­Ù†', meaning: 'Ø¥Ù†Ø§Ø¡ Ù…Ø³Ø·Ø­ Ù†Ø£ÙƒÙ„ ÙÙŠÙ‡', sentence: 'Ø¶Ø¹ Ø§Ù„Ø£Ø±Ø² ÙÙŠ Ø§Ù„ØµØ­Ù† Ù…Ù† ÙØ¶Ù„Ùƒ.' },
        { word: 'Ù…Ù„Ø¹Ù‚Ø©', meaning: 'Ø£Ø¯Ø§Ø© Ù„Ø£ÙƒÙ„ Ø§Ù„Ø­Ø³Ø§Ø¡ Ø£Ùˆ Ø§Ù„Ø£Ø±Ø²', sentence: 'Ø£Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ù„Ø¹Ù‚Ø© Ù„Ø£ÙƒÙ„ Ø§Ù„Ø´ÙˆØ±Ø¨Ø©.' },
        { word: 'Ø¨Ø±ØªÙ‚Ø§Ù„', meaning: 'ÙØ§ÙƒÙ‡Ø© Ø´ØªÙˆÙŠØ© ØºÙ†ÙŠØ© Ø¨Ø§Ù„ÙÙŠØªØ§Ù…ÙŠÙ†Ø§Øª', sentence: 'Ø¹ØµÙŠØ± Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ Ù…Ù†Ø¹Ø´ ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­.' }
    ],
    'Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¬Ø³Ù…': [
        { word: 'ÙŠØ¯', meaning: 'Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø°Ø±Ø§Ø¹ Ø¨Ù‡ Ø£ØµØ§Ø¨Ø¹', sentence: 'Ø£ÙƒØªØ¨ Ø¨ÙŠØ¯ÙŠ Ø§Ù„ÙŠÙ…Ù†Ù‰.' },
        { word: 'Ø¹ÙŠÙ†', meaning: 'Ø¹Ø¶Ùˆ Ø§Ù„Ø¥Ø¨ØµØ§Ø± ÙˆØ§Ù„Ø±Ø¤ÙŠØ©', sentence: 'Ø£Ø±Ù‰ Ø§Ù„Ø¹Ø§Ù„Ù… Ø¨Ø¹ÙŠÙ†ÙŠ Ø§Ù„Ø§Ø«Ù†ØªÙŠÙ†.' },
        { word: 'Ø±Ø£Ø³', meaning: 'Ø£Ø¹Ù„Ù‰ Ø¬Ø²Ø¡ ÙÙŠ Ø§Ù„Ø¬Ø³Ù…', sentence: 'Ø£Ø¶Ø¹ Ø§Ù„Ù‚Ø¨Ø¹Ø© Ø¹Ù„Ù‰ Ø±Ø£Ø³ÙŠ Ù„ØªØ­Ù…ÙŠÙ†ÙŠ Ù…Ù† Ø§Ù„Ø´Ù…Ø³.' },
        { word: 'Ù‚Ø¯Ù…', meaning: 'Ù†Ù…Ø´ÙŠ Ø¹Ù„ÙŠÙ‡Ø§ ÙˆÙ†Ø±ØªØ¯ÙŠ ÙÙŠÙ‡Ø§ Ø§Ù„Ø­Ø°Ø§Ø¡', sentence: 'Ø£Ø±ØªØ¯ÙŠ Ø§Ù„Ø­Ø°Ø§Ø¡ ÙÙŠ Ù‚Ø¯Ù…ÙŠ.' },
        { word: 'Ù„Ø³Ø§Ù†', meaning: 'Ø¹Ø¶Ùˆ Ø§Ù„ØªØ°ÙˆÙ‚ ÙˆØ§Ù„ÙƒÙ„Ø§Ù…', sentence: 'Ø£ØªØ°ÙˆÙ‚ Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„Ø­Ù„Ùˆ Ø¨Ù„Ø³Ø§Ù†ÙŠ.' },
        { word: 'Ø£ØµØ§Ø¨Ø¹', meaning: 'Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ø§Ù„ØµØºÙŠØ±Ø© ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙŠØ¯', sentence: 'Ù„Ø¯ÙŠ Ø®Ù…Ø³Ø© Ø£ØµØ§Ø¨Ø¹ ÙÙŠ ÙƒÙ„ ÙŠØ¯.' }
    ],
    'Ù…Ù‡Ù† ÙˆÙˆØ¸Ø§Ø¦Ù': [
        { word: 'Ø·Ø¨ÙŠØ¨', meaning: 'ÙŠØ¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø±Ø¶Ù‰ ÙÙŠ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰', sentence: 'Ø°Ù‡Ø¨ Ø§Ù„Ù…Ø±ÙŠØ¶ Ø¥Ù„Ù‰ Ø§Ù„Ø·Ø¨ÙŠØ¨.' },
        { word: 'Ù…Ø¹Ù„Ù…', meaning: 'ÙŠØ¯Ø±Ù‘Ø³ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©', sentence: 'Ø´Ø±Ø­ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø¯Ø±Ø³ Ø¨ÙˆØ¶ÙˆØ­.' },
        { word: 'Ø´Ø±Ø·ÙŠ', meaning: 'ÙŠØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù…Ù† ÙˆØ§Ù„Ù†Ø¸Ø§Ù…', sentence: 'ÙŠÙ†Ø¸Ù… Ø§Ù„Ø´Ø±Ø·ÙŠ Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø±ÙˆØ± ÙÙŠ Ø§Ù„Ø´Ø§Ø±Ø¹.' },
        { word: 'Ø®Ø¨Ø§Ø²', meaning: 'ÙŠØµÙ†Ø¹ Ø§Ù„Ø®Ø¨Ø² ÙˆØ§Ù„ÙƒØ¹Ùƒ Ø§Ù„Ù„Ø°ÙŠØ°', sentence: 'Ø±Ø§Ø¦Ø­Ø© Ø§Ù„Ø®Ø¨Ø² Ù…Ù† Ø§Ù„Ø®Ø¨Ø§Ø² Ø´Ù‡ÙŠØ©.' },
        { word: 'Ù…Ù‡Ù†Ø¯Ø³', meaning: 'ÙŠØµÙ…Ù… ÙˆÙŠØ¨Ù†ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ ÙˆØ§Ù„Ø¬Ø³ÙˆØ±', sentence: 'ØµÙ…Ù… Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø¨ÙŠØªØ§Ù‹ Ø¬Ù…ÙŠÙ„Ø§Ù‹.' },
        { word: 'ÙÙ†Ø§Ù†', meaning: 'Ø´Ø®Øµ ÙŠØ¨Ø¯Ø¹ ÙÙŠ Ø§Ù„Ø±Ø³Ù… Ø£Ùˆ Ø§Ù„Ù†Ø­Øª', sentence: 'Ø±Ø³Ù… Ø§Ù„ÙÙ†Ø§Ù† Ù„ÙˆØ­Ø© Ø·Ø¨ÙŠØ¹ÙŠØ© Ø±Ø§Ø¦Ø¹Ø©.' }
    ],
    'Ø£Ø¯ÙˆØ§Øª Ù…Ø¯Ø±Ø³ÙŠØ©': [
        { word: 'Ø¯ÙØªØ±', meaning: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£ÙˆØ±Ø§Ù‚ Ù†ÙƒØªØ¨ ÙÙŠÙ‡Ø§ Ø§Ù„Ø¯Ø±ÙˆØ³', sentence: 'Ø§Ø´ØªØ±ÙŠØª Ø¯ÙØªØ±Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹ Ù„Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª.' },
        { word: 'Ù…Ø³Ø·Ø±Ø©', meaning: 'Ù†Ø±Ø³Ù… Ø¨Ù‡Ø§ Ø®Ø·ÙˆØ·Ø§Ù‹ Ù…Ø³ØªÙ‚ÙŠÙ…Ø©', sentence: 'Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³Ø·Ø±Ø© Ù„Ø±Ø³Ù… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­ØµØµ.' },
        { word: 'Ø­Ù‚ÙŠØ¨Ø©', meaning: 'Ù†Ø­Ù…Ù„ ÙÙŠÙ‡Ø§ Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª', sentence: 'Ø­Ù‚ÙŠØ¨ØªÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© Ø«Ù‚ÙŠÙ„Ø© Ø§Ù„ÙŠÙˆÙ….' },
        { word: 'Ù…Ù…Ø­Ø§Ø©', meaning: 'Ù†Ù…Ø³Ø­ Ø¨Ù‡Ø§ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù‚Ù„Ù… Ø§Ù„Ø±ØµØ§Øµ', sentence: 'Ø£Ø¹Ø·Ù†ÙŠ Ø§Ù„Ù…Ù…Ø­Ø§Ø© Ù„Ø£ØµØ­Ø­ Ø§Ù„Ø®Ø·Ø£.' },
        { word: 'Ù…Ù‚Ù„Ù…Ø©', meaning: 'Ø­Ø§ÙØ¸Ø© Ù†Ø¶Ø¹ ÙÙŠÙ‡Ø§ Ø§Ù„Ø£Ù‚Ù„Ø§Ù…', sentence: 'Ø£Ù‚Ù„Ø§Ù…ÙŠ Ù…Ù„ÙˆÙ†Ø© ÙˆÙ…Ø±ØªØ¨Ø© ÙÙŠ Ø§Ù„Ù…Ù‚Ù„Ù…Ø©.' },
        { word: 'ÙƒØªØ§Ø¨', meaning: 'Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø§Øª Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©', sentence: 'Ø£Ø­Ø¨ Ù‚Ø±Ø§Ø¡Ø© ÙƒÙ„ ÙƒØªØ§Ø¨ Ø¬Ø¯ÙŠØ¯.' }
    ],
    'Ø£ÙØ¹Ø§Ù„ ÙˆØ­Ø±ÙƒØ©': [
        { word: 'ÙƒØªØ¨', meaning: 'Ø³Ø·Ù‘Ø± Ø§Ù„Ø­Ø±ÙˆÙ ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª', sentence: 'ÙƒØªØ¨ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ø¬Ø¨Ù‡ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ.' },
        { word: 'Ù‚Ø±Ø£', meaning: 'Ù†Ø¸Ø± ÙÙŠ Ø§Ù„Ù…ÙƒØªÙˆØ¨ ÙˆÙÙ‡Ù…Ù‡', sentence: 'Ù‚Ø±Ø£ Ø£Ø¨ÙŠ Ø§Ù„Ø¬Ø±ÙŠØ¯Ø© ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­.' },
        { word: 'ÙŠÙ„Ø¹Ø¨', meaning: 'ÙŠÙ…Ø§Ø±Ø³ Ù†Ø´Ø§Ø·Ø§Ù‹ Ù„Ù„ØªØ³Ù„ÙŠØ©', sentence: 'ÙŠÙ„Ø¹Ø¨ Ø§Ù„Ø·ÙÙ„ Ø¨Ø§Ù„ÙƒØ±Ø© ÙÙŠ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©.' },
        { word: 'ÙŠØ±Ø³Ù…', meaning: 'ÙŠØ®Ø·Ø· Ø´ÙƒÙ„Ø§Ù‹ Ø£Ùˆ ØµÙˆØ±Ø© Ø¨Ø§Ù„Ù‚Ù„Ù…', sentence: 'ÙŠØ±Ø³Ù… Ø£Ø®ÙŠ Ù…Ù†Ø¸Ø±Ø§Ù‹ Ø·Ø¨ÙŠØ¹ÙŠØ§Ù‹ Ø¬Ù…ÙŠÙ„Ø§Ù‹.' },
        { word: 'ÙŠØ³Ø¨Ø­', meaning: 'ÙŠØªØ­Ø±Ùƒ ÙˆÙŠØ¹ÙˆÙ… ÙÙŠ Ø§Ù„Ù…Ø§Ø¡', sentence: 'Ø£Ø­Ø¨ Ø£Ù† Ø£Ø³Ø¨Ø­ ÙÙŠ Ø§Ù„Ø¨Ø­Ø± ØµÙŠÙØ§Ù‹.' },
        { word: 'Ù‚ÙØ²', meaning: 'ÙˆØ«Ø¨ ÙˆØ§Ø±ØªÙØ¹ Ø¹Ù† Ø§Ù„Ø£Ø±Ø¶', sentence: 'Ù‚ÙØ² Ø§Ù„Ø£Ø±Ù†Ø¨ Ø¹Ø§Ù„ÙŠØ§Ù‹ ÙˆÙ‡Ø±Ø¨.' }
    ]
};
            this.soundManager = this.createSoundManager();
            this.init();
        }

        init() {
            this.loadProgress();
            this.updateHeaderUI();
            this.showLevelSelection();
            this.bindEvents();
        }

        createSoundManager() {
            // Use a try-catch block for environments where AudioContext might not be supported.
            let audioContext;
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.error("Web Audio API is not supported in this browser.");
                // Return a dummy object if AudioContext is not available
                return { init: ()=>{}, play: ()=>{}, toggle: ()=>{} };
            }

            const sounds = {
                pour: 'data:audio/wav;base64,UklGRmYFAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YVQFAACAgICAgICAhISEhYWFh4eHiYmJioqKi4uLjIyMjY2Njo6Ojw8PEBEREhISExMTFBQUFRUVFhYWFxcXGBgZGRkZGRoaGhkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGR-..',
                click: 'data:audio/wav;base64,UklGRlgBAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YVQBAACAgICAf39/f3+AgYCBgYGAgYCAgH9/f39/gICAgoKCg4ODhYWFh4eHiYmJioqKi4uLjIyMjY2Njo6Oj5CQkZGRkpKSk5OTlJSUlZWVlpaWl5eXmJiZmZmZmpqanJycnaCgoqOjpKSmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v8=',
                success: 'data:audio/wav;base64,UklGRlABAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YS8BAAD/AAAABgAADwAAABwAAAAwAAAAPwAAAEkAAABXAAAAZwAAAHUAAACBAAAAkQAAAJ8AAACzAAAAwAAAALIAAACtAAAAqQAAAKIAAACeAAAAkwAAAIYAAAB5AAAAcwAAAGAAAABOAAAARAAAAA8AAAAEAAAA/v//AAAAAwAAAAYAAAAJAAAADwAAABUAAAAcAAAAJAAAACwAAAAyAAAANwAAAD8AAABDQUJDQ0RFRkdISUpLTE1OT1BSUVNUVVZXWFlaW1xdXl9gYWJjZWZnaGlqa2xtbm9wcXJzdHV2d3h5ent8fX5/gIGCg4SFhoeIiYqLjI2Oj5CRkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1tre4ubq7vL2+v8DBwsPExcbHyMnKy8zNzs/Q0dLT1NXW19jZ2tvc3d7f4OHi4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v8=',
                fail: 'data:audio/wav;base64,UklGRmAAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YVQAAAAAw/z07u3w7/Lx7/Dt7e7s6+rq6Orp5+fm5eXl5eXj4uLh4eHf39/e3t7d3d3c3Nzb29va2trZ2dnY2NjX1t/a3d/e4OHj4+Tl5ufo6err7O3u7/Dx8vP09fb3+Pn6+/z9/v//////+fb18/Hx7+3s6+jn5eLg3dva2NfV09LRz87My8rJx8bFwcC/vry7urm4t7S0srGxraysqaioqKenpqampaWlo6OjoaGhoKCfn5+enp6dnZ2cnJybm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5ubm5-..',
                bgMusic: 'data:audio/mpeg;base64,SUQzBAAAAAAAI1RJTUsAAAAPAAAAMDAwMC5KU09OQU5U//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAwMDAwLmpzb25hbnT//uQxAAAAAAAAAAAAAAAAAAAAAAAVVVVVVVVVVVVVVVVVTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV-..',
            };
            const audioBuffers = {};
            let soundEnabled = true;
            let bgMusicNode = null;
            let userInteracted = false;

            const loadSound = (key) => {
                fetch(sounds[key])
                    .then(response => response.arrayBuffer())
                    .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer, (buffer) => {
                         audioBuffers[key] = buffer;
                         if(key === 'bgMusic') {
                            initBgMusic();
                         }
                    }));
            };

            const initBgMusic = () => {
                if (!audioBuffers.bgMusic) return;
                if (bgMusicNode) bgMusicNode.stop();

                bgMusicNode = audioContext.createBufferSource();
                bgMusicNode.buffer = audioBuffers.bgMusic;
                bgMusicNode.loop = true;

                const gainNode = audioContext.createGain();
                gainNode.gain.value = 0.3; // Lower volume for background music
                bgMusicNode.connect(gainNode).connect(audioContext.destination);

                if (soundEnabled && userInteracted) {
                   try { bgMusicNode.start(0); } catch(e) {}
                }
            };
            
            Object.keys(sounds).forEach(loadSound);

            return {
                init: () => {
                    if (!userInteracted) {
                        const startInteraction = () => {
                            userInteracted = true;
                            if (audioContext.state === 'suspended') {
                                audioContext.resume();
                            }
                            initBgMusic();
                            window.removeEventListener('click', startInteraction);
                            window.removeEventListener('touchstart', startInteraction);
                        }
                        window.addEventListener('click', startInteraction);
                        window.addEventListener('touchstart', startInteraction);
                    }
                },
                play: (sound) => {
                    if (!soundEnabled || !audioBuffers[sound]) return;
                    const source = audioContext.createBufferSource();
                    source.buffer = audioBuffers[sound];
                    source.connect(audioContext.destination);
                    source.start(0);
                },
                toggle: (enabled) => {
                    soundEnabled = enabled;
                    if (soundEnabled) {
                        if (audioContext.state === 'suspended') audioContext.resume();
                        initBgMusic();
                    } else {
                        if (bgMusicNode) {
                            try { bgMusicNode.stop(); } catch(e) {}
                            bgMusicNode = null;
                        }
                    }
                },
                get isEnabled() { return soundEnabled; }
            };
        }
        
        // --- Data Management ---
        saveProgress() {
            const progress = {
                gems: this.gameState.gems,
                stars: this.gameState.stars,
                unlockedWorlds: this.gameState.unlockedWorlds,
                completedLevels: this.gameState.completedLevels,
            };
            localStorage.setItem('colorSortGameProgress', JSON.stringify(progress));
        }

        loadProgress() {
            const progress = JSON.parse(localStorage.getItem('colorSortGameProgress'));
            if (progress) {
                this.gameState.gems = progress.gems || 0;
                this.gameState.stars = progress.stars || 0;
                this.gameState.unlockedWorlds = progress.unlockedWorlds || ['Ø­ÙŠÙˆØ§Ù†Ø§Øª'];
                this.gameState.completedLevels = progress.completedLevels || [];
            }
        }
        
        // --- UI Update ---
        updateHeaderUI() {
            this.DOM.gems.textContent = this.gameState.gems;
            this.DOM.stars.textContent = this.gameState.stars;
        }

        showModal(modalToShow) {
            this.DOM.modalContainer.classList.remove('opacity-0', 'pointer-events-none');
            [this.DOM.levelStartModal, this.DOM.successModal, this.DOM.gameOverModal].forEach(modal => {
                modal.classList.add('hidden');
            });
            modalToShow.classList.remove('hidden');
            setTimeout(() => {
                modalToShow.classList.remove('scale-95');
            }, 10);
        }
        
        hideAllModals() {
            this.DOM.modalContainer.classList.add('opacity-0', 'pointer-events-none');
            [this.DOM.levelStartModal, this.DOM.successModal, this.DOM.gameOverModal].forEach(m => {
                 m.classList.add('hidden', 'scale-95');
            });
        }

        // --- Screen Management ---
        showLevelSelection() {
            this.DOM.gameScreen.classList.add('hidden');
            this.DOM.levelSelection.innerHTML = '';
            this.DOM.levelSelection.classList.remove('hidden');

            Object.keys(this.levels).forEach(worldName => {
                const isUnlocked = this.gameState.unlockedWorlds.includes(worldName);
                const worldContainer = document.createElement('div');
                worldContainer.className = `glass-effect rounded-2xl p-6 mb-8 ${isUnlocked ? 'hover:border-blue-400' : 'opacity-50'}`;
                
                let worldLevelsHTML = '';
                this.levels[worldName].forEach((level, index) => {
                    const levelId = `${worldName}-${index}`;
                    const isCompleted = this.gameState.completedLevels.includes(levelId);
                    worldLevelsHTML += `
                        <button data-level-id="${levelId}" class="level-btn relative w-20 h-20 sm:w-24 sm:h-24 rounded-full flex flex-col items-center justify-center font-bold text-lg
                            ${isUnlocked ? 'bg-gray-700 hover:bg-blue-600 transition-all neon-glow' : 'bg-gray-800 cursor-not-allowed'}
                            ${isCompleted ? 'border-4 border-yellow-400' : 'border-4 border-gray-600'}" 
                            ${!isUnlocked ? 'disabled' : ''}>
                            <span class="text-2xl">${level.word}</span>
                            ${isCompleted ? '<span class="absolute -top-2 -right-2 text-2xl">â­</span>' : ''}
                        </button>
                    `;
                });

                worldContainer.innerHTML = `
                    <h2 class="text-3xl font-bold mb-4 flex items-center gap-3">
                        ${!isUnlocked ? 'ğŸ”’' : 'ğŸŒ'} ${worldName}
                    </h2>
                    <div class="flex flex-wrap justify-center gap-4">
                        ${worldLevelsHTML}
                    </div>
                `;
                this.DOM.levelSelection.appendChild(worldContainer);
            });

            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const [world, levelIndex] = btn.dataset.levelId.split('-');
                    this.prepareLevel(world, parseInt(levelIndex));
                });
            });
        }

        prepareLevel(world, levelIndex) {
            this.gameState.currentLevel = { world, levelIndex };
            const level = this.levels[world][levelIndex];
            
            document.getElementById('startWord').textContent = level.word;
            document.getElementById('startMeaning').textContent = level.meaning;
            document.getElementById('startSentence').textContent = `Ù…Ø«Ø§Ù„: "${level.sentence}"`;
            this.soundManager.play('click');
            this.showModal(this.DOM.levelStartModal);
        }
        
        startLevel() {
            this.hideAllModals();
            this.DOM.levelSelection.classList.add('hidden');
            this.DOM.gameScreen.classList.remove('hidden');

            this.gameState.isPouring = false;
            this.gameState.selectedBottleIndex = null;
            this.gameState.timeLeft = this.config.baseLevelTime;

            const { world, levelIndex } = this.gameState.currentLevel;
            const level = this.levels[world][levelIndex];
            
            this.DOM.currentLevelDisplay.textContent = `${world} - ${levelIndex + 1}`;
            this.DOM.targetWord.textContent = level.word;
            this.setupBottles(level.word);
            this.renderBottles();
            this.startTimer();
        }
        
        setupBottles(word) {
            const targetLetters = [...new Set(word.split(''))];
            const numTargetBottles = targetLetters.length;
            const numExtraBottles = 2;
            const totalFilledBottles = numTargetBottles + Math.min(2, Math.floor(word.length / 2)); // Add more bottles for longer words

            let allColors = [];
            word.split('').forEach(letter => {
                for (let i = 0; i < this.config.bottleCapacity; i++) {
                    allColors.push(letter);
                }
            });
            
            // Shuffle colors
            for (let i = allColors.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allColors[i], allColors[j]] = [allColors[j], allColors[i]];
            }
            
            this.gameState.bottleContents = [];
            for (let i = 0; i < totalFilledBottles; i++) {
                this.gameState.bottleContents.push([]);
            }
            
            // Distribute colors into bottles
            let colorIndex = 0;
            for (let i = 0; i < allColors.length; i++) {
                 this.gameState.bottleContents[i % totalFilledBottles].push(allColors[i]);
            }
            
            // Add empty bottles
            for (let i = 0; i < numExtraBottles; i++) {
                this.gameState.bottleContents.push([]);
            }
        }
        
        renderBottles() {
            this.DOM.bottlesArea.innerHTML = '';
            this.gameState.bottleContents.forEach((content, index) => {
                const bottleEl = document.createElement('div');
                bottleEl.className = 'bottle';
                bottleEl.dataset.index = index;
                if(this.gameState.selectedBottleIndex === index) {
                    bottleEl.classList.add('selected');
                }

                const liquidStack = document.createElement('div');
                liquidStack.className = 'liquid-stack';

                content.forEach(letter => {
                    const liquidUnit = document.createElement('div');
                    liquidUnit.className = 'liquid-unit';
                    liquidUnit.style.backgroundColor = this.colorMap[letter] || '#333';
                    liquidUnit.textContent = letter;
                    liquidStack.appendChild(liquidUnit);
                });
                
                bottleEl.appendChild(liquidStack);
                this.DOM.bottlesArea.appendChild(bottleEl);
                
                bottleEl.addEventListener('click', () => this.handleBottleClick(index));
            });
        }

        handleBottleClick(index) {
            if (this.gameState.isPouring) return;
            this.soundManager.play('click');
            
            if (this.gameState.selectedBottleIndex === null) {
                if (this.gameState.bottleContents[index].length > 0) {
                    this.gameState.selectedBottleIndex = index;
                    document.querySelector(`[data-index='${index}']`).classList.add('selected');
                }
            } else {
                if (this.gameState.selectedBottleIndex !== index) {
                    this.pour(this.gameState.selectedBottleIndex, index);
                }
                const oldSelection = this.gameState.selectedBottleIndex;
                this.gameState.selectedBottleIndex = null;
                document.querySelector(`[data-index='${oldSelection}']`)?.classList.remove('selected');
            }
        }
        
        pour(fromIndex, toIndex) {
            const fromBottle = this.gameState.bottleContents[fromIndex];
            const toBottle = this.gameState.bottleContents[toIndex];
            
            if (fromBottle.length === 0) return;
            
            const colorToMove = fromBottle[fromBottle.length - 1];
            
            if (toBottle.length > 0 && toBottle[toBottle.length - 1] !== colorToMove) {
                this.soundManager.play('fail');
                return;
            }
            if (toBottle.length >= this.config.bottleCapacity) {
                this.soundManager.play('fail');
                return;
            }

            this.gameState.isPouring = true;
            document.querySelector(`[data-index='${fromIndex}']`).classList.add('pour-animation');
            this.soundManager.play('pour');
            
            // Logic to move the color units
            const unitsToMove = [];
            for (let i = fromBottle.length - 1; i >= 0; i--) {
                if (fromBottle[i] === colorToMove) {
                    unitsToMove.unshift(fromBottle[i]);
                } else {
                    break;
                }
            }

            // Check if there is space in the target bottle
            if (toBottle.length + unitsToMove.length > this.config.bottleCapacity) {
                this.gameState.isPouring = false;
                 document.querySelector(`[data-index='${fromIndex}']`).classList.remove('pour-animation');
                this.soundManager.play('fail');
                return;
            }
            
            setTimeout(() => {
                fromBottle.splice(fromBottle.length - unitsToMove.length, unitsToMove.length);
                toBottle.push(...unitsToMove);
                
                this.renderBottles();
                this.gameState.isPouring = false;
                this.checkWinCondition();
            }, 400);
        }
        
        // --- MODIFIED CODE START ---
        checkWinCondition() {
            const targetWord = this.DOM.targetWord.textContent;
            
            // Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ø±ÙŠØ± Ø¥Ù…Ø§ Ù…ÙƒØªÙ…Ù„Ø© Ø£Ùˆ ÙØ§Ø±ØºØ©.
            // Ø£ÙŠ Ù‚Ø§Ø±ÙˆØ±Ø© Ù…Ù…ØªÙ„Ø¦Ø© Ø¬Ø²Ø¦ÙŠÙ‹Ø§ ØªØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„Ù„ØºØ² Ù„Ù… ÙŠØªÙ… Ø­Ù„Ù‡ Ø¨Ø¹Ø¯.
            for (const bottle of this.gameState.bottleContents) {
                const isComplete = bottle.length === this.config.bottleCapacity && new Set(bottle).size === 1;
                const isEmpty = bottle.length === 0;
                
                if (!isEmpty && !isComplete) {
                    // Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø±ÙˆØ±Ø© ÙÙŠ Ø­Ø§Ù„Ø© ÙˆØ³ÙŠØ·Ø©ØŒ Ù„Ø°Ù„Ùƒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙˆØ² Ø¨Ø¹Ø¯.
                    return;
                }
            }

            // Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙƒÙ„Ù…Ø© Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø±ÙŠØ± Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©.
            // Ø¨Ø³Ø¨Ø¨ `dir="rtl"`ØŒ ÙŠØªÙˆØ§ÙÙ‚ ØªØ±ØªÙŠØ¨ DOM Ù…Ø¹ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø±Ø¦ÙŠ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±.
            const sortedLetters = [];
            for (const bottle of this.gameState.bottleContents) {
                // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„Ù‚Ø§Ø±ÙˆØ±Ø© ÙØ§Ø±ØºØ©ØŒ ÙÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…ÙƒØªÙ…Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØ­Øµ Ø§Ù„Ø£ÙˆÙ„.
                if (bottle.length > 0) {
                    sortedLetters.push(bottle[0]);
                }
            }
            
            const formedWord = sortedLetters.join('');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…ÙƒÙˆÙ†Ø© Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø±ÙŠØ± (Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±) ØªØ·Ø§Ø¨Ù‚ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©.
            if (formedWord === targetWord) {
                this.levelComplete();
            }
        }
        // --- MODIFIED CODE END ---
        
        levelComplete() {
            clearInterval(this.gameState.timer);
            this.soundManager.play('success');
            
            const gemsEarned = 10 + Math.floor(this.gameState.timeLeft / 10);
            const starsEarned = this.gameState.timeLeft > (this.config.baseLevelTime * 0.75) ? 3 : this.gameState.timeLeft > (this.config.baseLevelTime * 0.4) ? 2 : 1;
            
            this.gameState.gems += gemsEarned;
            this.gameState.stars += starsEarned;
            
            const {world, levelIndex} = this.gameState.currentLevel;
            const levelId = `${world}-${levelIndex}`;
            if (!this.gameState.completedLevels.includes(levelId)) {
                this.gameState.completedLevels.push(levelId);
            }

            const currentWorldLevels = this.levels[world];
            if (levelIndex === currentWorldLevels.length - 1) {
                const worldNames = Object.keys(this.levels);
                const currentWorldIndex = worldNames.indexOf(world);
                if(currentWorldIndex + 1 < worldNames.length) {
                    const nextWorld = worldNames[currentWorldIndex + 1];
                    if(!this.gameState.unlockedWorlds.includes(nextWorld)){
                        this.gameState.unlockedWorlds.push(nextWorld);
                    }
                }
            }
            
            this.saveProgress();
            this.updateHeaderUI();
            
            document.getElementById('completedWord').textContent = this.levels[world][levelIndex].word;
            document.getElementById('gemsEarned').textContent = `+${gemsEarned}`;
            document.getElementById('starsEarned').textContent = `+${starsEarned}`;
            
            setTimeout(() => this.showModal(this.DOM.successModal), 500);
        }
        
        startTimer() {
            clearInterval(this.gameState.timer);
            this.DOM.timer.textContent = this.gameState.timeLeft;
            this.DOM.timer.parentElement.classList.remove('text-yellow-400', 'animate-ping');

            this.gameState.timer = setInterval(() => {
                this.gameState.timeLeft--;
                this.DOM.timer.textContent = this.gameState.timeLeft;
                if (this.gameState.timeLeft <= 10) {
                     this.DOM.timer.parentElement.classList.add('text-yellow-400', 'animate-ping');
                }
                if (this.gameState.timeLeft <= 0) {
                    this.gameOver();
                }
            }, 1000);
        }

        gameOver() {
            clearInterval(this.gameState.timer);
            this.soundManager.play('fail');
            this.showModal(this.DOM.gameOverModal);
        }

        resetLevel() {
            clearInterval(this.gameState.timer);
            this.startLevel();
        }
        
        provideHint() {
            if (this.gameState.gems < this.config.hintCost) {
                alert("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø¬ÙˆØ§Ù‡Ø± ÙƒØ§ÙÙŠØ©!");
                return;
            }

            this.gameState.gems -= this.config.hintCost;
            this.updateHeaderUI();
            this.saveProgress();

            for(let i=0; i < this.gameState.bottleContents.length; i++){
                const fromBottle = this.gameState.bottleContents[i];
                if(fromBottle.length === 0 || (new Set(fromBottle).size === 1 && fromBottle.length === this.config.bottleCapacity)) continue;

                const topColor = fromBottle[fromBottle.length-1];
                let unitsToMoveCount = 0;
                for(let k = fromBottle.length -1; k >= 0; k--){
                    if(fromBottle[k] === topColor) unitsToMoveCount++; else break;
                }

                for(let j=0; j < this.gameState.bottleContents.length; j++){
                    if(i === j) continue;
                    const toBottle = this.gameState.bottleContents[j];
                    if(toBottle.length + unitsToMoveCount <= this.config.bottleCapacity && (toBottle.length === 0 || toBottle[toBottle.length-1] === topColor)){
                        const bottles = document.querySelectorAll('.bottle');
                        bottles[i].classList.add('selected');
                        setTimeout(() => { bottles[j].classList.add('selected'); }, 500);
                        setTimeout(() => {
                           bottles[i]?.classList.remove('selected');
                           bottles[j]?.classList.remove('selected');
                        }, 1500);
                        return;
                    }
                }
            }
        }

        bindEvents() {
            this.DOM.startLevelBtn.addEventListener('click', () => this.startLevel());
            this.DOM.backBtn.addEventListener('click', () => {
                clearInterval(this.gameState.timer);
                this.showLevelSelection();
            });
            this.DOM.resetBtn.addEventListener('click', () => this.resetLevel());
            this.DOM.retryBtn.addEventListener('click', () => {
                this.hideAllModals();
                this.resetLevel();
            });
            this.DOM.nextLevelBtn.addEventListener('click', () => {
                this.hideAllModals();
                const {world, levelIndex} = this.gameState.currentLevel;
                const worldLevels = this.levels[world];
                
                if(levelIndex + 1 < worldLevels.length){
                    this.prepareLevel(world, levelIndex + 1);
                } else {
                     const worldNames = Object.keys(this.levels);
                     const currentWorldIndex = worldNames.indexOf(world);
                     if(currentWorldIndex + 1 < worldNames.length){
                         this.prepareLevel(worldNames[currentWorldIndex+1], 0);
                     } else {
                         this.showLevelSelection();
                         alert('ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª!');
                     }
                }
            });
            
            this.DOM.soundToggle.addEventListener('click', () => {
                const willBeEnabled = !this.soundManager.isEnabled;
                this.soundManager.toggle(willBeEnabled);
                const iconPath = willBeEnabled
                    ? "M10 2a1 1 0 00-1 1v14a1 1 0 002 0V3a1 1 0 00-1-1zM5 6a1 1 0 00-1 1v6a1 1 0 002 0V7a1 1 0 00-1-1zm10 0a1 1 0 00-1 1v6a1 1 0 002 0V7a1 1 0 00-1-1z" // volume up
                    : "M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z"; // volume off
                this.DOM.soundIconPath.setAttribute('d', iconPath);
            });
            
            this.DOM.speakBtn.addEventListener('click', () => {
                if ('speechSynthesis' in window) {
                    const textToSpeak = this.DOM.targetWord.textContent;
                    const utterance = new SpeechSynthesisUtterance(textToSpeak);
                    utterance.lang = 'ar-SA';
                    speechSynthesis.speak(utterance);
                } else {
                    alert('Ø¹Ø°Ø±Ù‹Ø§ØŒ Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ù†Ø·Ù‚ Ø§Ù„ÙƒÙ„Ù…Ø§Øª.');
                }
            });
            
            this.DOM.hintBtn.addEventListener('click', () => this.provideHint());
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        window.game = new ProfessionalColorSortGame();
    });
    </script>
</body>
</html>