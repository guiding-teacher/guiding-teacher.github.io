
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© Ø¨Ø§Ø²Ù„ Ø§Ù„Ø¬Ù…Ù„Ø© - 50 Ù„ØºØ²Ø§Ù‹ Ù…ØªØ¯Ø±Ø¬Ø§Ù‹</title>
    <!-- Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø®Ø· Amiri Ù…Ù† Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <!-- Ù…ÙƒØªØ¨Ø© Ù‚ØµØ§ØµØ§Øª Ø§Ù„ÙˆØ±Ù‚ Ø§Ù„Ù…Ù„ÙˆÙ†Ø© -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --base-piece-size: 140px; /* Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ù‚Ø·Ø¹Ø© */
            --gap-size: 10px;
            --border-radius: 15px;
            --glow-color: rgba(144, 238, 144, 0.8);
            --hint-color: #ffc107;
        }

        html {
            height: 100%;
            box-sizing: border-box;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }

        body {
            font-family: 'Amiri', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            min-height: 100vh;
            background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
            margin: 0;
            padding: 15px;
            color: #333;
            overflow-x: hidden;
            overflow-y: auto;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 900px;
            flex-grow: 1;
            justify-content: center;
        }

        h1 {
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            text-align: center;
            margin-top: 0;
            margin-bottom: 5px;
        }

        .instructions {
            color: #f8f8f8;
            margin-bottom: 15px;
            text-align: center;
            font-size: clamp(1rem, 3vw, 1.3rem);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        #puzzle-area {
             display: flex;
             justify-content: center;
             align-items: center;
             width: 100%;
             max-width: calc(4 * var(--base-piece-size) + 3 * var(--gap-size));
             position: relative;
             margin: 0 auto;
        }

        #puzzle-container {
            width: 100%;
            display: grid;
            gap: var(--gap-size);
            background-color: rgba(255, 255, 255, 0.5);
            border: 1px solid #ccc;
            padding: var(--gap-size);
            border-radius: var(--border-radius);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            transition: all 0.3s ease-in-out;
        }
        
        .puzzle-piece {
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1rem, 3.5vw, 1.8rem); /* Ø­Ø¬Ù… Ø®Ø· Ù…ØªÙˆØ§Ø²Ù† */
            line-height: 1.3;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.3s ease, filter 0.3s ease;
            user-select: none;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.4), 0 4px 8px rgba(0,0,0,0.25);
            text-align: center;
            padding: 5px;
            box-sizing: border-box;
            overflow: hidden;
            word-break: break-word;
            border-radius: calc(var(--border-radius) * 0.6);
        }

        .puzzle-piece:hover:not(.locked-in-sequence) {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .puzzle-piece.selected:not(.locked-in-sequence) {
            border: 4px solid gold;
            transform: scale(1.08);
            z-index: 20;
        }

        .puzzle-piece.locked-in-sequence {
             cursor: default;
             box-shadow: 0 0 15px 5px var(--glow-color);
             filter: brightness(1.1);
             transform: scale(1.01);
             z-index: 5;
        }

        .piece-color-0{background-color:#e67e22}.piece-color-1{background-color:#27ae60}.piece-color-2{background-color:#8e44ad}.piece-color-3{background-color:#2980b9}.piece-color-4{background-color:#f1c40f}.piece-color-5{background-color:#c0392b}.piece-color-6{background-color:#16a085}.piece-color-7{background-color:#d35400}.piece-color-8{background-color:#34495e}.piece-color-9{background-color:#7f8c8d}.piece-color-10{background-color:#2ecc71}.piece-color-11{background-color:#e74c3c}.piece-color-12{background-color:#9b59b6}.piece-color-13{background-color:#3498db}.piece-color-14{background-color:#f39c12}.piece-color-15{background-color:#1abc9c}

        .controls-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 900px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 15px 15px 0 0;
            box-shadow: 0 -3px 10px rgba(0,0,0,0.1);
            margin-top: 15px;
        }

        .stats-guide-container {
             display: flex;
             justify-content: space-around;
             align-items: center;
             width: 100%;
             margin-bottom: 10px;
             flex-wrap: wrap;
             gap: 15px;
        }

        .stats { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }

        #level-display, #move-counter, #countdown-timer {
            background-color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: inset 0 1px 4px rgba(0,0,0,0.15);
            font-size: clamp(0.9rem, 2.5vw, 1.2rem);
            min-width: 100px;
            text-align: center;
        }
        
        #countdown-timer.warning {
             color: #dc3545;
             font-weight: bold;
             animation: pulse 1s infinite;
        }
        
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        #guide-area { text-align: center; }
        #guide-emojis { font-size: clamp(2rem, 6vw, 3rem); margin-bottom: 5px; cursor: default; }
        #feedback { font-weight: bold; min-height: 24px; transition: color 0.3s ease; font-size: clamp(1rem, 3vw, 1.2rem); }
        #feedback.info { color: #007bff; }
        #feedback.win { color: #28a745; }
        #feedback.error { color: #dc3545; }

        .buttons-row { display: flex; gap: 15px; margin-top: 10px; }

        #start-reset-button, #help-button {
            padding: 10px 20px;
            font-size: clamp(1rem, 2.5vw, 1.2rem);
            font-weight: bold;
            color: white; border: none; border-radius: 8px; cursor: pointer;
            transition: all 0.2s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex; align-items: center; gap: 8px;
        }
        
        #start-reset-button { background: linear-gradient(180deg, #5cb85c, #4cae4c); }
        #start-reset-button:hover { background: linear-gradient(180deg, #4cae4c, #398439); }
        #start-reset-button:disabled { background: #ccc; cursor: not-allowed; }
        
        #help-button { background: linear-gradient(180deg, var(--hint-color), #ffab00); }
        #help-button:hover { background: linear-gradient(180deg, #ffab00, #ff8f00); }
        
        #sound-toggle {
            position: absolute; top: 15px; left: 15px;
            background: rgba(255, 255, 255, 0.7); border: none; border-radius: 50%;
            width: 40px; height: 40px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2em; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 100;
        }

        .modal {
            display: none; position: fixed; z-index: 1001;
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6);
            align-items: center; justify-content: center; padding: 15px;
        }
        
        .modal-content {
            background-color: #fefefe; margin: auto; padding: 25px;
            width: 90%; max-width: 550px; border-radius: 15px;
            text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        
        .modal-content h2 { font-size: clamp(1.5rem, 4vw, 1.8rem); margin-bottom: 15px; }
        .modal-content p { font-size: clamp(1rem, 3vw, 1.3rem); margin-bottom: 20px; line-height: 1.6;}
        
        .completed-sentence {
            background-color: #e9f5ec; padding: 15px; border-radius: 10px;
            margin: 15px 0; font-size: clamp(1.1rem, 3.5vw, 1.4rem); font-weight: bold;
            color: #2E8B57; border: 2px dashed #2E8B57;
        }
        
        .modal-buttons { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;}
        .modal-buttons button { padding: 10px 20px; font-size: clamp(0.9rem, 2.5vw, 1.1rem); font-weight: bold; border-radius: 8px; cursor: pointer; border: none; }
        #next-puzzle-button { background: linear-gradient(180deg, #5cb85c, #4cae4c); color: white; }
        #end-game-button { background: linear-gradient(180deg, #f0ad4e, #ec971f); color: white; }
        #retry-puzzle-button { background: linear-gradient(180deg, #0275d8, #025aa5); color: white; }

        .hint-piece { animation: pulse-hint 1.5s infinite ease-in-out; z-index: 50; }
        @keyframes pulse-hint { 50% { transform: scale(1.1); box-shadow: 0 0 25px rgba(255, 215, 0, 0.9); } }
        .correct-position-indicator {
            position: absolute; width: 100%; height: 100%;
            border: 4px dashed var(--hint-color);
            border-radius: inherit;
            z-index: 40; pointer-events: none;
            animation: glow-hint 2s infinite ease-in-out;
            box-sizing: border-box;
        }
        @keyframes glow-hint { 50% { opacity: 1; box-shadow: 0 0 20px 5px var(--hint-color); } }

        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; pointer-events: none; display: none; }
    </style>
</head>
<body>
    <canvas id="confetti-canvas"></canvas>

    <button id="sound-toggle" title="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª"><i class="fas fa-volume-up"></i></button>

    <div class="game-container">
        <h1>Ù„Ø¹Ø¨Ø© Ø¨Ø§Ø²Ù„ Ø§Ù„Ø¬Ù…Ù„Ø©</h1>
        <p class="instructions">Ø±ØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù„ØªÙƒÙˆÙŠÙ† Ø¬Ù…Ù„Ø© ØµØ­ÙŠØ­Ø© Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª!</p>
        <div id="puzzle-area">
            <div id="puzzle-container"></div>
        </div>
    </div>

    <footer class="controls-area">
         <div class="stats-guide-container">
            <div class="stats">
                <div id="level-display">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: -</div>
                <div id="countdown-timer">Ø§Ù„ÙˆÙ‚Øª: --</div>
                <div id="move-counter">Ø§Ù„Ø­Ø±ÙƒØ§Øª: -</div>
            </div>
             <div id="guide-area">
                <div id="guide-emojis">ğŸ§©âœ¨ğŸ¯</div>
                <p id="feedback">Ø§Ø¶ØºØ· "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©"</p>
            </div>
        </div>
        <div class="buttons-row">
            <button id="help-button" title="Ù…Ø³Ø§Ø¹Ø¯Ø©"><i class="fas fa-question-circle"></i><span>Ù…Ø³Ø§Ø¹Ø¯Ø©</span></button>
            <button id="start-reset-button"><i class="fas fa-play"></i><span>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</span></button>
        </div>
    </footer>

    <!-- Modal for puzzle/level completion -->
    <div id="completion-modal" class="modal">
        <div class="modal-content">
            <h2 id="completion-title">ğŸ‰ Ø£Ø­Ø³Ù†Øª! ğŸ‰</h2>
            <p id="completion-message">Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù„ØºØ² Ø¨Ù†Ø¬Ø§Ø­!</p>
            <div class="completed-sentence" id="completed-sentence-text"></div>
            <div class="modal-buttons">
                <button id="next-puzzle-button">Ø§Ù„Ù„ØºØ² Ø§Ù„ØªØ§Ù„ÙŠ</button>
                <button id="end-game-button">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
            </div>
        </div>
    </div>
    
    <!-- Modal for timeout -->
    <div id="timeout-modal" class="modal">
        <div class="modal-content">
            <h2>â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!</h2>
            <p>Ù„Ù„Ø£Ø³ÙØŒ Ù„Ù… ØªÙ†Ø¬Ø­ ÙÙŠ Ø­Ù„ Ø§Ù„Ù„ØºØ² ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯.</p>
            <div class="modal-buttons">
                <button id="retry-puzzle-button">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
                <button id="end-game-timeout-button">Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements ---
        const puzzleContainer = document.getElementById('puzzle-container');
        const startResetButton = document.getElementById('start-reset-button');
        const helpButton = document.getElementById('help-button');
        const feedbackElement = document.getElementById('feedback');
        const countdownTimerElement = document.getElementById('countdown-timer');
        const moveCounterElement = document.getElementById('move-counter');
        const levelDisplayElement = document.getElementById('level-display');
        const soundToggle = document.getElementById('sound-toggle');
        const confettiCanvas = document.getElementById('confetti-canvas');
        const completionModal = document.getElementById('completion-modal');
        const completionTitle = document.getElementById('completion-title');
        const completionMessage = document.getElementById('completion-message');
        const completedSentenceText = document.getElementById('completed-sentence-text');
        const nextPuzzleButton = document.getElementById('next-puzzle-button');
        const endGameButton = document.getElementById('end-game-button');
        const timeoutModal = document.getElementById('timeout-modal');
        const retryPuzzleButton = document.getElementById('retry-puzzle-button');
        const endGameTimeoutButton = document.getElementById('end-game-timeout-button');

        // --- Game Data ---
        const puzzlesByLevel = [
            // Level 1: Easy (4-6 words)
            [{sentence:["Ø§Ù„Ù‚Ø·Ø§Ø±Ù","Ø³Ø±ÙŠØ¹ÙŒ","Ø¬Ø¯Ø§Ù‹","."]}, {sentence:["Ø§Ù„Ø³Ù…Ø§Ø¡Ù","Ø²Ø±Ù‚Ø§Ø¡Ù","ÙˆØ¬Ù…ÙŠÙ„Ø©ÙŒ","."]}, {sentence:["Ø£Ø­Ø¨Ù","Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©Ù","ÙˆØ§Ù„ÙƒØªØ§Ø¨Ø©Ù","."]}, {sentence:["Ø§Ù„Ø£Ø³Ø¯Ù","Ù…Ù„ÙƒÙ","Ø§Ù„ØºØ§Ø¨Ø©Ù","."]}, {sentence:["ØªÙ„Ø¹Ø¨Ù","Ø§Ù„Ø·ÙÙ„Ø©Ù","Ø¨Ø§Ù„Ø¯Ù…ÙŠØ©Ù","."]}, {sentence:["Ø§Ù„Ø´Ù…Ø³Ù","Ù…ØµØ¯Ø±Ù","Ø§Ù„Ø¶ÙˆØ¡Ù","ÙˆØ§Ù„Ø¯ÙØ¡Ù","."]}, {sentence:["Ø§Ù„Ù…Ø§Ø¡Ù","Ø³Ø±ÙÙ‘","Ø§Ù„Ø­ÙŠØ§Ø©Ù","Ù„Ù„Ø¬Ù…ÙŠØ¹Ù","."]}, {sentence:["Ø£Ø°Ù‡Ø¨Ù","Ø¥Ù„Ù‰","Ø§Ù„Ù…Ø¯Ø±Ø³Ø©Ù","ÙƒÙ„ÙÙ‘","ÙŠÙˆÙ…Ù","."]}, {sentence:["Ø§Ù„Ø¹Ù„Ù…Ù","Ù†ÙˆØ±ÙŒ","ÙˆØ§Ù„Ø¬Ù‡Ù„Ù","Ø¸Ù„Ø§Ù…ÙŒ","."]}, {sentence:["Ø§Ù„Ù†Ø¸Ø§ÙØ©Ù","Ù…Ù†","Ø§Ù„Ø¥ÙŠÙ…Ø§Ù†Ù","."]}],
            // Level 2: Medium (6-8 words)
            [{sentence:["ÙŠØ³Ø§Ø¹Ø¯Ù","Ø§Ù„ÙˆÙ„Ø¯Ù","ÙˆØ§Ù„Ø¯ÙÙ‡","ÙÙŠ","Ø£Ø¹Ù…Ø§Ù„Ù","Ø§Ù„Ù…Ù†Ø²Ù„Ù","."]}, {sentence:["Ù‚Ø±Ø§Ø¡Ø©Ù","Ø§Ù„ÙƒØªØ¨Ù","ØªÙØªØ­Ù","Ø§Ù„Ø¹Ù‚ÙˆÙ„Ù","ÙˆØªÙ†Ù…ÙŠ","Ø§Ù„ÙÙƒØ±Ù","."]}, {sentence:["Ø§Ù„Ø±ÙŠØ§Ø¶Ø©Ù","Ù…ÙÙŠØ¯Ø©ÙŒ","Ù„ØµØ­Ø©Ù","Ø§Ù„Ø¬Ø³Ù…Ù","ÙˆØ§Ù„Ø¹Ù‚Ù„Ù","."]}, {sentence:["ÙŠØ²ÙˆØ±Ù","Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡Ù","Ø¨Ø¹Ø¶ÙÙ‡Ù…","ÙÙŠ","Ø§Ù„Ø£Ø¹ÙŠØ§Ø¯Ù","ÙˆØ§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§ØªÙ","."]}, {sentence:["ÙŠØ¹ÙŠØ´Ù","Ø§Ù„Ø³Ù…ÙƒÙ","ÙÙŠ","Ø§Ù„Ù…Ø§Ø¡Ù","ÙˆÙ„Ø§","ÙŠØ³ØªØ·ÙŠØ¹Ù","Ù…ØºØ§Ø¯Ø±ØªÙÙ‡","."]}, {sentence:["ÙŠØ­Ø¨ÙÙ‘","Ø§Ù„Ø£Ø·ÙØ§Ù„Ù","Ø§Ù„Ù„Ø¹Ø¨Ù","ÙÙŠ","Ø§Ù„Ø­Ø¯Ø§Ø¦Ù‚Ù","Ø§Ù„Ø¹Ø§Ù…Ø©Ù","."]}, {sentence:["Ø±Ù…Ø¶Ø§Ù†Ù","Ø´Ù‡Ø±Ù","Ø§Ù„Ø®ÙŠØ±Ù","ÙˆØ§Ù„Ø¨Ø±ÙƒØ©Ù","ÙˆØ§Ù„Ø±Ø­Ù…Ø©Ù","."]}, {sentence:["Ù†Ø­Ù†Ù","Ù†Ø­ØªØ±Ù…Ù","Ø§Ù„Ù…Ø¹Ù„Ù…Ù","Ù„Ø£Ù†Ù‡","ÙŠØ±Ø¨ÙŠ","Ø§Ù„Ø£Ø¬ÙŠØ§Ù„Ù","."]}, {sentence:["Ø§Ù„ØµØ¨Ø±Ù","Ù…ÙØªØ§Ø­Ù","Ø§Ù„ÙØ±Ø¬Ù","Ø¨Ø¹Ø¯Ù","Ø§Ù„Ø´Ø¯Ø©Ù","."]}, {sentence:["ØªØ·ÙŠØ±Ù","Ø§Ù„Ø·ÙŠÙˆØ±Ù","Ø¹Ø§Ù„ÙŠØ©Ù‹","ÙÙŠ","Ø§Ù„Ø³Ù…Ø§Ø¡Ù","Ø§Ù„ØµØ§ÙÙŠØ©Ù","."]}],
            // Level 3: Advanced (8-10 words)
            [{sentence:["Ø§Ù„Ø¹Ù…Ù„Ù","Ø§Ù„Ø¬Ø§Ø¯ÙÙ‘","Ù‡Ùˆ","Ø§Ù„Ø·Ø±ÙŠÙ‚Ù","Ø§Ù„ÙˆØ­ÙŠØ¯Ù","Ù„ØªØ­Ù‚ÙŠÙ‚Ù","Ø§Ù„Ø£Ø­Ù„Ø§Ù…Ù","Ø§Ù„ÙƒØ¨ÙŠØ±Ø©Ù","."]}, {sentence:["Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©Ù","Ø§Ù„Ø®Ù„Ø§Ø¨Ø©Ù","ØªÙÙ„Ù‡Ù…Ù","Ø§Ù„ÙÙ†Ø§Ù†ÙŠÙ†Ù","ÙˆØªØ±ÙŠØ­Ù","Ø§Ù„Ù†ÙÙˆØ³Ù","Ù…Ù†","Ø¶Ø¬ÙŠØ¬Ù","Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©Ù","."]}, {sentence:["Ø§Ù„ØµØ¯Ø§Ù‚Ø©Ù","Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©Ù","ÙƒÙ†Ø²ÙŒ","Ø«Ù…ÙŠÙ†ÙŒ","ÙŠØ¬Ø¨Ù","Ø£Ù†","Ù†Ø­Ø§ÙØ¸Ù","Ø¹Ù„ÙŠÙ‡Ù","."]}, {sentence:["ÙŠØ¬Ø¨Ù","Ø¹Ù„ÙŠÙ†Ø§","Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù","Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§","Ø¨Ø­ÙƒÙ…Ø©Ù","Ù„Ù„Ø§Ø³ØªÙØ§Ø¯Ø©Ù","Ù…Ù†","Ù…Ø²Ø§ÙŠØ§Ù‡Ø§","."]}, {sentence:["Ø§Ù„Ù„ØºØ©Ù","Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©Ù","Ù…Ù†","Ø£Ø¬Ù…Ù„Ù","Ù„ØºØ§ØªÙ","Ø§Ù„Ø¹Ø§Ù„Ù…Ù","ÙˆØ£ØºÙ†Ø§Ù‡Ø§","Ø¨Ø§Ù„Ù…ÙØ±Ø¯Ø§ØªÙ","."]}, {sentence:["ÙƒØ§Ù†","Ø§Ø¨Ù†Ù","Ø§Ù„Ù‡ÙŠØ«Ù…Ù","Ø¹Ø§Ù„Ù…Ù‹Ø§","Ø¹Ø¸ÙŠÙ…Ù‹Ø§","ÙÙŠ","Ù…Ø¬Ø§Ù„Ù","Ø§Ù„Ø¨ØµØ±ÙŠØ§ØªÙ","ÙˆØ§Ù„ÙÙŠØ²ÙŠØ§Ø¡Ù","."]}, {sentence:["Ø§Ù„Ø­ÙØ§Ø¸Ù","Ø¹Ù„Ù‰","Ø§Ù„Ø¨ÙŠØ¦Ø©Ù","Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©ÙŒ","Ø¬Ù…Ø§Ø¹ÙŠØ©ÙŒ","Ù„Ø¶Ù…Ø§Ù†Ù","Ù…Ø³ØªÙ‚Ø¨Ù„Ù","Ø£ÙØ¶Ù„Ù","."]}, {sentence:["Ø§Ù„ØªÙØ§Ø¤Ù„Ù","ÙŠÙ…Ù†Ø­Ù","Ø§Ù„Ø¥Ù†Ø³Ø§Ù†Ù","Ø§Ù„Ù‚ÙˆØ©Ù","Ù„Ù…ÙˆØ§Ø¬Ù‡Ø©Ù","ØªØ­Ø¯ÙŠØ§ØªÙ","ÙˆØµØ¹ÙˆØ¨Ø§ØªÙ","Ø§Ù„Ø­ÙŠØ§Ø©Ù","."]}, {sentence:["Ø§Ù„Ù‚Ù…Ø±Ù","ÙŠØ¯ÙˆØ±Ù","Ø­ÙˆÙ„Ù","Ø§Ù„Ø£Ø±Ø¶Ù","ÙˆÙ‡ÙŠ","ØªØ¯ÙˆØ±Ù","Ø­ÙˆÙ„Ù","Ø§Ù„Ø´Ù…Ø³Ù","."]}, {sentence:["Ø§Ù„Ø³ÙØ±Ù","ÙŠÙˆØ³Ø¹Ù","Ø§Ù„Ø¢ÙØ§Ù‚Ù","ÙˆÙŠØ¹Ø±ÙÙ†Ø§","Ø¹Ù„Ù‰","Ø«Ù‚Ø§ÙØ§ØªÙ","ÙˆØ­Ø¶Ø§Ø±Ø§ØªÙ","Ù…Ø®ØªÙ„ÙØ©Ù","."]}],
            // Level 4: Hard (10-12 words)
            [{sentence:["Ø§Ù„Ù†Ø¬Ø§Ø­Ù","ÙŠØªØ·Ù„Ø¨Ù","Ø§Ù„ØµØ¨Ø±Ù","ÙˆØ§Ù„Ù…Ø«Ø§Ø¨Ø±Ø©Ù","ÙˆØ§Ù„ØªØ®Ø·ÙŠØ·Ù","Ø§Ù„Ø¬ÙŠØ¯Ù","ÙˆØ§Ù„ØªÙˆÙƒÙ„Ù","Ø¹Ù„Ù‰","Ø§Ù„Ù„Ù‡Ù","Ø£ÙˆÙ„Ø§Ù‹","."]}, {sentence:["ÙŠÙØ¹ØªØ¨Ø±Ù","Ø§Ù„Ø£Ø¯Ø¨Ù","Ù…Ø±Ø¢Ø©Ù‹","ØªØ¹ÙƒØ³Ù","ÙˆØ§Ù‚Ø¹Ù","Ø§Ù„Ù…Ø¬ØªÙ…Ø¹Ø§ØªÙ","ÙˆØªØ¹Ø¨Ø±Ù","Ø¹Ù†","Ø¢Ù…Ø§Ù„ÙÙ‡Ø§","ÙˆØ¢Ù„Ø§Ù…ÙÙ‡Ø§","."]}, {sentence:["ÙŠØ¬Ø¨Ù","Ø£Ù†","Ù†Ø³ØªØ«Ù…Ø±Ù","Ø£ÙˆÙ‚Ø§ØªÙ","ÙØ±Ø§ØºÙÙ†Ø§","ÙÙŠ","Ø£Ø´ÙŠØ§Ø¡Ù","Ù…ÙÙŠØ¯Ø©Ù","ØªÙ†Ù…ÙŠ","Ù…Ù‡Ø§Ø±Ø§ØªÙÙ†Ø§","ÙˆÙ‚Ø¯Ø±Ø§ØªÙÙ†Ø§","."]}, {sentence:["Ø¥Ù†","Ø¨Ø±ÙÙ‘","Ø§Ù„ÙˆØ§Ù„Ø¯ÙŠÙ†Ù","Ù…Ù†","Ø£Ø¹Ø¸Ù…Ù","Ø§Ù„Ø£Ø¹Ù…Ø§Ù„Ù","Ø§Ù„ØªÙŠ","ØªÙ‚Ø±Ø¨Ù","Ø§Ù„Ø¹Ø¨Ø¯Ù","Ù…Ù†","Ø±Ø¨ÙÙ‘Ù‡Ù","."]}, {sentence:["Ø§Ù„Ø­Ø¶Ø§Ø±Ø©Ù","Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©Ù","ØªØ±ÙƒØªÙ’","Ø¨ØµÙ…Ø§ØªÙ","ÙˆØ§Ø¶Ø­Ø©Ù‹","ÙÙŠ","Ù…Ø®ØªÙ„ÙÙ","Ø§Ù„Ø¹Ù„ÙˆÙ…Ù","ÙˆØ§Ù„ÙÙ†ÙˆÙ†Ù","ÙˆØ§Ù„Ø¢Ø¯Ø§Ø¨Ù","."]}, {sentence:["Ø§Ù„ÙˆÙ‚ØªÙ","ÙƒØ§Ù„Ø³ÙŠÙÙ","Ø¥Ù†","Ù„Ù…","ØªÙ‚Ø·Ø¹Ù’Ù‡Ù","Ù‚Ø·Ø¹ÙÙƒÙ","ÙØ§ØºØªÙ†Ù…Ù’","ÙƒÙ„ÙÙ‘","Ù„Ø­Ø¸Ø©Ù","ÙÙŠÙ‡Ù","."]}, {sentence:["ØªØ³Ø¹Ù‰","Ø§Ù„Ø¯ÙˆÙ„Ù","Ø¬Ø§Ù‡Ø¯Ø©Ù‹","Ù„ØªØ·ÙˆÙŠØ±Ù","Ø£Ù†Ø¸Ù…ØªÙÙ‡Ø§","Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©Ù","Ù„Ù…ÙˆØ§ÙƒØ¨Ø©Ù","Ø§Ù„ØªØ·ÙˆØ±Ø§ØªÙ","Ø§Ù„Ø¹Ù„Ù…ÙŠØ©Ù","Ø§Ù„Ù…ØªØ³Ø§Ø±Ø¹Ø©Ù","."]}, {sentence:["Ø§Ù„Ø¹Ù‚Ù„Ù","Ø§Ù„Ø³Ù„ÙŠÙ…Ù","ÙÙŠ","Ø§Ù„Ø¬Ø³Ù…Ù","Ø§Ù„Ø³Ù„ÙŠÙ…Ù","Ù„Ø°Ø§","Ø§Ù‡ØªÙ…ÙÙ‘","Ø¨ØºØ°Ø§Ø¦ÙÙƒÙ","ÙˆØ±Ø±ÙŠØ§Ø¶ØªÙÙƒÙ","."]}, {sentence:["Ù„ÙƒÙ„ÙÙ‘","Ù…Ø¬ØªÙ‡Ø¯Ù","Ù†ØµÙŠØ¨ÙŒ","ÙÙ„Ø§","ÙŠÙŠØ£Ø³Ù’","Ø£Ø­Ø¯ÙŒ","Ù…Ù†","ØªØ­Ù‚ÙŠÙ‚Ù","Ù‡Ø¯ÙÙ‡Ù","Ù…Ù‡Ù…Ø§","ÙƒØ§Ù†","."]}, {sentence:["Ø§Ù„ØªØ³Ø§Ù…Ø­Ù","Ù‡Ùˆ","Ø£Ø³Ø§Ø³Ù","Ø§Ù„ØªØ¹Ø§ÙŠØ´Ù","Ø§Ù„Ø³Ù„Ù…ÙŠÙÙ‘","Ø¨ÙŠÙ†","Ø§Ù„Ø´Ø¹ÙˆØ¨Ù","Ø¹Ù„Ù‰","Ø§Ø®ØªÙ„Ø§ÙÙ","Ø£Ø¯ÙŠØ§Ù†ÙÙ‡Ø§","."]}],
            // Level 5: Expert (Proverbs)
            [{sentence:["Ù…Ù†","Ø¬Ø¯ÙÙ‘","ÙˆØ¬Ø¯Ù","ÙˆÙ…Ù†","Ø²Ø±Ø¹Ù","Ø­ØµØ¯Ù","ÙˆÙ…Ù†","Ø³Ø§Ø±Ù","Ø¹Ù„Ù‰","Ø§Ù„Ø¯Ø±Ø¨Ù","ÙˆØµÙ„Ù","."]}, {sentence:["Ø¥Ø°Ø§","ÙƒØ§Ù†","Ø§Ù„ÙƒÙ„Ø§Ù…Ù","Ù…Ù†","ÙØ¶Ø©Ù","ÙØ§Ù„Ø³ÙƒÙˆØªÙ","Ù…Ù†","Ø°Ù‡Ø¨Ù","ÙÙŠ","Ø¨Ø¹Ø¶Ù","Ø§Ù„Ù…ÙˆØ§Ù‚ÙÙ","."]}, {sentence:["Ù„Ø§","ØªØ¤Ø¬Ù„Ù’","Ø¹Ù…Ù„Ù","Ø§Ù„ÙŠÙˆÙ…Ù","Ø¥Ù„Ù‰","Ø§Ù„ØºØ¯Ù","ÙØ¥Ù†","Ù„ÙƒÙ„ÙÙ‘","ÙŠÙˆÙ…Ù","Ø¹Ù…Ù„ÙÙ‡","."]}, {sentence:["Ø¹Ù†Ø¯Ù","Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ù","ÙŠÙÙƒØ±ÙÙ…Ù","Ø§Ù„Ù…Ø±Ø¡Ù","Ø£Ùˆ","ÙŠÙÙ‡Ø§Ù†Ù","ÙÙƒÙ†Ù’","Ù…Ø³ØªØ¹Ø¯Ø§Ù‹","Ø¯Ø§Ø¦Ù…Ø§Ù‹","."]}, {sentence:["ÙŠØ¯ÙŒ","ÙˆØ§Ø­Ø¯Ø©ÙŒ","Ù„Ø§","ØªØµÙÙ‚Ù","ÙˆÙ„ÙƒÙ†Ù‡Ø§","ØªØ³ØªØ·ÙŠØ¹Ù","Ø£Ù†","ØªØ²Ø±Ø¹Ù","Ø§Ù„Ø£Ù…Ù„Ù","."]}, {sentence:["Ù…Ù†","Ø·Ù„Ø¨Ù","Ø§Ù„Ø¹Ù„Ø§","Ø³Ù‡Ø±Ù","Ø§Ù„Ù„ÙŠØ§Ù„ÙŠ","ÙˆØ§Ø¬ØªÙ‡Ø¯Ù","ÙÙŠ","Ø·Ù„Ø¨Ù","Ø§Ù„Ø¹Ù„Ù…Ù","ÙˆØ§Ù„Ø¹Ù…Ù„Ù","."]}, {sentence:["Ø§Ù„Ø¬Ø§Ø±Ù","Ù‚Ø¨Ù„Ù","Ø§Ù„Ø¯Ø§Ø±Ù","ÙˆØ§Ù„Ø±ÙÙŠÙ‚Ù","Ù‚Ø¨Ù„Ù","Ø§Ù„Ø·Ø±ÙŠÙ‚Ù","ÙØ§Ø®ØªØ±Ù’Ù‡Ù…Ø§","Ø¨Ø¹Ù†Ø§ÙŠØ©Ù","ÙØ§Ø¦Ù‚Ø©Ù","."]}, {sentence:["Ø±Ø¨ÙÙ‘","Ø£Ø®Ù","Ù„ÙƒÙ","Ù„Ù…","ØªÙ„Ø¯Ù‡Ù","Ø£Ù…ÙÙ‘ÙƒÙ","ØªØ¬Ø¯ÙÙ‡Ù","Ø³Ù†Ø¯Ø§Ù‹","ÙˆØ¹ÙˆÙ†Ø§Ù‹","Ù„ÙƒÙ","."]}, {sentence:["Ù…Ù†","ÙŠØ²Ø±Ø¹Ù","Ø§Ù„Ù…Ø¹Ø±ÙˆÙÙ","ÙÙŠ","ØºÙŠØ±Ù","Ø£Ù‡Ù„ÙÙ‡","ÙŠÙƒÙ†Ù’","Ø­Ù…Ø¯ÙÙ‡","Ø°Ù…Ø§Ù‹","Ø¹Ù„ÙŠÙ‡Ù","ÙˆÙŠÙ†Ø¯Ù…Ù","."]}, {sentence:["Ø§Ù„Ø¹Ù„Ù…Ù","ÙÙŠ","Ø§Ù„ØµØºØ±Ù","ÙƒØ§Ù„Ù†Ù‚Ø´Ù","ÙÙŠ","Ø§Ù„Ø­Ø¬Ø±Ù","ÙŠØ¨Ù‚Ù‰","Ø£Ø«Ø±ÙÙ‡","Ø·ÙˆØ§Ù„Ù","Ø§Ù„Ø¹Ù…Ø±Ù","."]}],
        ];
        
        // --- Game State ---
        let currentLevelNumber = 1, puzzlesInLevel = 10, puzzlesCompletedThisLevel = 0, currentLevelPuzzles = [], currentPuzzle = {};
        let selectedPiece = null, gameActive = false, nextExpectedCorrectIndex = 0, countdownInterval = null, remainingTime = 60, moveCount = 0;
        let soundEnabled = true, audioContext, hintIndicator = null;
        
        const initAudioContext = () => { if (!audioContext && (window.AudioContext || window.webkitAudioContext)) audioContext = new (window.AudioContext || window.webkitAudioContext)(); };
        
        const playTone = (type) => {
            if (!soundEnabled || !audioContext) return;
            if (audioContext.state === 'suspended') { audioContext.resume(); }
            try {
                const o = audioContext.createOscillator(), g = audioContext.createGain();
                o.connect(g); g.connect(audioContext.destination); g.gain.setValueAtTime(0.1, audioContext.currentTime);
                let f=440, d=0.1, w='sine';
                switch(type){
                    case 'click': f=900; w='triangle'; d=0.06; break;
                    case 'swap': f=300; o.frequency.linearRampToValueAtTime(500, audioContext.currentTime+0.08); break;
                    case 'correct_sequence': f=600; w='square'; g.gain.setValueAtTime(0.08, audioContext.currentTime); break;
                    case 'win': f=523; w='sawtooth'; d=0.5; g.gain.setValueAtTime(0.12, audioContext.currentTime); o.frequency.linearRampToValueAtTime(f*2, audioContext.currentTime+0.4); break;
                    case 'timeout': f=200; w='square'; d=0.5; g.gain.setValueAtTime(0.15, audioContext.currentTime); break;
                    case 'hint': f=880; d=0.2; g.gain.setValueAtTime(0.07, audioContext.currentTime); break;
                }
                o.type = w; o.frequency.setValueAtTime(f, audioContext.currentTime);
                g.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + d);
                o.start(); o.stop(audioContext.currentTime + d);
            } catch (e) { console.error("Error playing sound:", e); }
        };
        
        const shuffleArray = (arr) => arr.sort(() => Math.random() - 0.5);
        const calculateGridDimensions = c => {
            if(c<=4)return{rows:2,cols:2}; if(c<=6)return{rows:2,cols:3}; if(c<=9)return{rows:3,cols:3};
            if(c<=12)return{rows:3,cols:4}; if(c<=16)return{rows:4,cols:4}; return{rows:4,cols:Math.ceil(c/4)};
        };

        const updateCountdownDisplay = () => { countdownTimerElement.textContent = `Ø§Ù„ÙˆÙ‚Øª: ${remainingTime} Ø«`; };
        const stopCountdownTimer = () => { clearInterval(countdownInterval); countdownInterval = null; };
        const startCountdownTimer = () => {
            stopCountdownTimer();
            remainingTime = 15 + (currentPuzzle.sentence.length * 4); // Dynamic time
            updateCountdownDisplay();
            countdownInterval = setInterval(() => {
                remainingTime--; updateCountdownDisplay();
                if (remainingTime <= 0) handleTimeUp();
                countdownTimerElement.classList.toggle('warning', remainingTime <= 10);
            }, 1000);
        };
        const resetMoveCounter = () => { moveCount = 0; moveCounterElement.textContent = `Ø§Ù„Ø­Ø±ÙƒØ§Øª: 0`; };
        const incrementMoveCounter = () => { moveCount++; moveCounterElement.textContent = `Ø§Ù„Ø­Ø±ÙƒØ§Øª: ${moveCount}`; };
        
        const removeHint = () => {
            document.querySelectorAll('.hint-piece').forEach(p => p.classList.remove('hint-piece'));
            if(hintIndicator) { hintIndicator.remove(); hintIndicator = null; }
        };

        const showHint = () => {
            if (!gameActive || !currentPuzzle.sentence || nextExpectedCorrectIndex >= currentPuzzle.sentence.length) return;
            removeHint();
            
            const pieceToHint = Array.from(puzzleContainer.children)
                .find(p => parseInt(p.dataset.correctIndex) === nextExpectedCorrectIndex);
            
            if (pieceToHint) {
                playTone('hint');
                pieceToHint.classList.add('hint-piece');
                
                const { cols } = calculateGridDimensions(currentPuzzle.sentence.length);
                const correctPosition = nextExpectedCorrectIndex;
                
                hintIndicator = document.createElement('div');
                hintIndicator.className = 'correct-position-indicator';
                hintIndicator.style.gridRow = Math.floor(correctPosition / cols) + 1;
                hintIndicator.style.gridColumn = (correctPosition % cols) + 1;
                
                puzzleContainer.appendChild(hintIndicator);
            }
        };

        const setupLevel = (levelNum) => {
            currentLevelNumber = levelNum;
            puzzlesCompletedThisLevel = 0;
            currentLevelPuzzles = shuffleArray([...puzzlesByLevel[levelNum - 1]]);
            setupPuzzle(false);
        };

        const setupPuzzle = (isRetry = false) => {
            removeHint();
            if (!isRetry) {
                if (currentLevelPuzzles.length === 0) { endGame(true); return; }
                currentPuzzle = currentLevelPuzzles.pop();
            }
            const { sentence } = currentPuzzle;
            const pieceCount = sentence.length;
            const { rows, cols } = calculateGridDimensions(pieceCount);
            
            puzzleContainer.innerHTML = '';
            puzzleContainer.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            puzzleContainer.style.gridTemplateRows = `repeat(${rows}, 1fr)`;

            selectedPiece = null; gameActive = true; nextExpectedCorrectIndex = 0;
            updateUIForNewPuzzle();
            
            const shuffledIndices = shuffleArray([...Array(pieceCount).keys()]);
            shuffledIndices.forEach(wordIndex => {
                const piece = document.createElement('div');
                piece.classList.add('puzzle-piece', `piece-color-${wordIndex % 16}`);
                piece.textContent = sentence[wordIndex];
                piece.dataset.correctIndex = wordIndex;
                piece.addEventListener('click', handlePieceClick);
                puzzleContainer.appendChild(piece);
            });
            checkAndLockSequence();
        };

        const handlePieceClick = (e) => {
            if (!gameActive) return;
            const clickedPiece = e.target.closest('.puzzle-piece');
            if (!clickedPiece || clickedPiece.classList.contains('locked-in-sequence')) return;
            if (!countdownInterval) startCountdownTimer();
            playTone('click'); removeHint();
            if (!selectedPiece) {
                selectedPiece = clickedPiece; selectedPiece.classList.add('selected');
            } else {
                if (clickedPiece !== selectedPiece) {
                    const p1 = selectedPiece, p2 = clickedPiece;
                    const p1Next = p1.nextSibling === p2 ? p1 : p1.nextSibling;
                    p1.parentNode.insertBefore(p1, p2); p1.parentNode.insertBefore(p2, p1Next);
                    incrementMoveCounter(); checkAndLockSequence();
                }
                selectedPiece.classList.remove('selected'); selectedPiece = null;
            }
        };
        
        const checkAndLockSequence = () => {
            const currentGridPieces = Array.from(puzzleContainer.children);
            let lockedCount = 0;
            for (let i = nextExpectedCorrectIndex; i < currentGridPieces.length; i++) {
                const piece = currentGridPieces[i];
                if (parseInt(piece.dataset.correctIndex) === i) {
                    if (!piece.classList.contains('locked-in-sequence')) {
                        piece.classList.add('locked-in-sequence');
                        piece.removeEventListener('click', handlePieceClick);
                        lockedCount++;
                    }
                } else break;
            }
            if (lockedCount > 0) {
                nextExpectedCorrectIndex += lockedCount; playTone('correct_sequence');
                feedbackElement.textContent = `Ø±Ø§Ø¦Ø¹! ${nextExpectedCorrectIndex} ${nextExpectedCorrectIndex > 2 ? 'ÙƒÙ„Ù…Ø§Øª' : 'ÙƒÙ„Ù…ØªØ§Ù†'} ØµØ­ÙŠØ­Ø©!`;
            }
            if (nextExpectedCorrectIndex === currentPuzzle.sentence.length) handleWin();
        };

        const handleWin = () => {
            gameActive = false; stopCountdownTimer(); playTone('win');
            try{ confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } }); } catch(e){}
            puzzlesCompletedThisLevel++;
            feedbackElement.textContent = `ğŸ‰ Ù…Ù…ØªØ§Ø²! Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù„ØºØ²! ğŸ‰`; feedbackElement.className = 'win';
            completedSentenceText.textContent = currentPuzzle.sentence.join(' ');
            if (puzzlesCompletedThisLevel >= puzzlesInLevel) {
                if (currentLevelNumber >= puzzlesByLevel.length) {
                    completionTitle.textContent = "ğŸ† ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ø£ØªÙ‚Ù†Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! ğŸ†";
                    completionMessage.textContent = "Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø§Ù‡Ø±. Ø£Ù†Øª Ø¨Ø·Ù„ Ø§Ù„Ø£Ù„ØºØ§Ø²!";
                    nextPuzzleButton.style.display = 'none';
                } else {
                    completionTitle.textContent = `ğŸ‰ Ø±Ø§Ø¦Ø¹! Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevelNumber}! ğŸ‰`;
                    completionMessage.textContent = "Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ø§Ù„Ø¢Ù† Ù„ØªØ­Ø¯Ù Ø¬Ø¯ÙŠØ¯. Ù‡Ù„ Ø£Ù†Øª Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠØŸ";
                    nextPuzzleButton.textContent = `Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentLevelNumber + 1}`;
                    nextPuzzleButton.style.display = 'inline-block';
                    nextPuzzleButton.onclick = () => { completionModal.style.display = 'none'; setupLevel(currentLevelNumber + 1); };
                }
            } else {
                completionTitle.textContent = "ğŸ‰ Ø£Ø­Ø³Ù†Øª! ğŸ‰";
                completionMessage.textContent = "Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ù‡Ø°Ø§ Ø§Ù„Ù„ØºØ² Ø¨Ù†Ø¬Ø§Ø­. Ø§Ø³ØªØ¹Ø¯ Ù„Ù„ØªØ­Ø¯ÙŠ Ø§Ù„ØªØ§Ù„ÙŠ!";
                nextPuzzleButton.textContent = "Ø§Ù„Ù„ØºØ² Ø§Ù„ØªØ§Ù„ÙŠ";
                nextPuzzleButton.style.display = 'inline-block';
                nextPuzzleButton.onclick = () => { completionModal.style.display = 'none'; setupPuzzle(false); };
            }
            setTimeout(() => { completionModal.style.display = 'flex'; }, 1000);
        };
        const handleTimeUp = () => {
            stopCountdownTimer(); playTone('timeout'); gameActive = false; removeHint();
            feedbackElement.textContent = "â³ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!"; feedbackElement.className = 'error';
            timeoutModal.style.display = 'flex';
        };

        const updateUIForNewPuzzle = () => {
            stopCountdownTimer();
            feedbackElement.textContent = 'Ø±ØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ù„ØªÙƒÙˆÙŠÙ† Ø¬Ù…Ù„Ø© ØµØ­ÙŠØ­Ø©!'; feedbackElement.className = 'info';
            const startButtonSpan = startResetButton.querySelector('span');
            const startButtonIcon = startResetButton.querySelector('i');
            startButtonSpan.textContent = "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„ØºØ²"; startButtonIcon.className = "fas fa-redo";
            startResetButton.disabled = false; helpButton.disabled = false;
            resetMoveCounter();
            levelDisplayElement.textContent = `Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ${currentLevelNumber} (Ø§Ù„Ù„ØºØ² ${puzzlesCompletedThisLevel + 1}/${puzzlesInLevel})`;
            countdownTimerElement.textContent = "Ø§Ù„ÙˆÙ‚Øª: --"; countdownTimerElement.classList.remove('warning');
        };
        
        const endGame = (completedAll = false) => {
            stopCountdownTimer(); gameActive = false;
            puzzleContainer.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; font-size: 1.5em; color: #333;">${completedAll ? 'ğŸ† Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø¹Ø¨! Ù„Ù‚Ø¯ Ø£ØªÙ‚Ù†Øª ÙƒÙ„ Ø§Ù„Ø£Ù„ØºØ§Ø²! ğŸ†' : 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! Ø§Ø¶ØºØ· "Ø§Ø¨Ø¯Ø£" Ù„Ù„Ø¹Ø¨ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.'}</p>`;
            const startButtonSpan = startResetButton.querySelector('span');
            const startButtonIcon = startResetButton.querySelector('i');
            startButtonSpan.textContent = "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©"; startButtonIcon.className = "fas fa-play";
            startResetButton.disabled = false; helpButton.disabled = true;
            resetMoveCounter();
            levelDisplayElement.textContent = "Ø§Ù„Ù…Ø³ØªÙˆÙ‰: -"; countdownTimerElement.textContent = "Ø§Ù„ÙˆÙ‚Øª: --";
        };

        startResetButton.addEventListener('click', () => {
            initAudioContext();
            const isNewGame = startResetButton.querySelector('span').textContent === "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©";
            isNewGame ? setupLevel(1) : setupPuzzle(true);
        });

        helpButton.addEventListener('click', () => { if(gameActive) showHint(); });
        soundToggle.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            soundToggle.innerHTML = soundEnabled ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
        });
        endGameButton.addEventListener('click', () => { completionModal.style.display = 'none'; endGame(); });
        retryPuzzleButton.addEventListener('click', () => { timeoutModal.style.display = 'none'; setupPuzzle(true); });
        endGameTimeoutButton.addEventListener('click', () => { timeoutModal.style.display = 'none'; endGame(); });

        const initializeGame = () => {
            puzzleContainer.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; font-size: 1.3em;">Ø§Ø¶ØºØ· "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©" Ù„Ù„ØªØ­Ø¯ÙŠ!</p>';
            helpButton.disabled = true;
        };

        initializeGame();
    });
    </script>
</body>
</html>
