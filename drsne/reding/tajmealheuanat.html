<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù„Ø¹Ø¨Ø© ØªØ¬Ù…ÙŠØ¹ ØµÙˆØ± Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root {
      --primary: #FF6B6B;
      --secondary: #4ECDC4;
      --accent: #FFE66D;
      --dark: #292F36;
      --light: #F7FFF7;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      overflow-x: hidden;
    }

    /* --- ØªØ¹Ø¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯: Ø²Ø± ÙƒØªÙ… Ø§Ù„ØµÙˆØª --- */
    .mute-btn {
      position: fixed;
      top: 20px;
      left: 20px; /* ÙÙŠ Ø§Ù„ÙŠØ³Ø§Ø± Ù„ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ÙƒÙ„Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ */
      z-index: 250;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: var(--secondary);
      color: white;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: transform 0.2s ease, background-color 0.2s ease;
    }
    .mute-btn:hover {
      transform: scale(1.1);
    }
    .mute-btn.muted {
        background-color: var(--primary);
    }
    /* --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ --- */
    
    h1 {
      color: var(--dark);
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 15px;
      font-size: 2.2rem;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: pulse 2s infinite;
    }
    h1 .fa-paw { margin: 0 10px; }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .screen { display: none; width: 100%; max-width: 800px; }
    .screen.active { display: flex; flex-direction: column; align-items: center; }

    #roundsScreen h2 {
      font-size: 2rem;
      color: var(--dark);
      margin-bottom: 20px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    #roundsContainer {
        width: 100%;
        display: grid;
        gap: 15px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 15px;
        box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        grid-template-columns: repeat(2, 1fr);
    }
    .round-btn {
        padding: 15px;
        font-size: 1.2rem;
        font-weight: bold;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid var(--secondary);
        background-color: var(--light);
        color: var(--dark);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
        aspect-ratio: 1 / 1;
    }
    .round-btn:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 8px 15px rgba(78, 205, 196, 0.3);
    }
    .round-btn.locked {
        background-color: #e9ecef;
        border-color: #ced4da;
        color: #adb5bd;
        cursor: not-allowed;
    }
    .round-btn.locked:hover {
        transform: none;
        box-shadow: none;
    }
    .round-btn .fa-lock, .round-btn .fa-play { font-size: 1.5rem; }

    @media (min-width: 480px) { #roundsContainer { grid-template-columns: repeat(3, 1fr); } }
    @media (min-width: 768px) { #roundsContainer { grid-template-columns: repeat(4, 1fr); gap: 20px; } }
    @media (min-width: 1024px) { #roundsContainer { grid-template-columns: repeat(5, 1fr); } }

    .game-header { display: flex; flex-direction: column; align-items: center; width: 100%; max-width: 500px; margin-bottom: 20px; }
    .animal-name { font-size: 1.8rem; font-weight: bold; color: var(--dark); background-color: var(--accent); padding: 8px 20px; border-radius: 30px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 10px; text-align: center; animation: bounce 0.5s ease infinite alternate; }
    @keyframes bounce { to { transform: translateY(-5px); } }
    .level-info { font-size: 1.2rem; color: var(--dark); background-color: white; padding: 8px 15px; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 15px; display: flex; gap: 15px; text-align: right; }
    .timer-container { position: relative; width: 100px; height: 100px; }
    .timer { width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(var(--secondary) calc(var(--time) * 1%), #ddd 0%); display: flex; align-items: center; justify-content: center; font-size: 1.8rem; font-weight: bold; color: var(--dark); box-shadow: 0 4px 10px rgba(0,0,0,0.1); position: relative; z-index: 2; }
    .timer::before { content: ''; position: absolute; width: 85%; height: 85%; background: white; border-radius: 50%; z-index: -1; }
    .top-container { width: 100%; max-width: 500px; display: flex; justify-content: center; gap: 25px; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 6px 15px rgba(0,0,0,0.1); margin-bottom: 25px; border: 3px dashed var(--accent); min-height: 150px; align-items: center; }
    .top-slot { width: 100px; height: 100px; background: #f0f4f8; border-radius: 15px; overflow: hidden; display: flex; align-items: center; justify-content: center; border: 3px solid var(--secondary); transition: all 0.3s ease; position: relative; }
    .top-slot::after { content: '?'; position: absolute; font-size: 2.5rem; color: rgba(0,0,0,0.1); z-index: 1; }
    .top-slot.filled::after { display: none; }
    .top-slot img { width: 100%; height: 100%; object-fit: cover; z-index: 2; }
    .images-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; width: 100%; max-width: 500px; margin-bottom: 20px; }
    .image-box { aspect-ratio: 1/1; border-radius: 15px; overflow: hidden; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: all 0.3s ease; position: relative; background: #f0f4f8; border: 3px solid white; }
    .image-box:hover { transform: scale(1.05); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
    .image-box img { width: 100%; height: 100%; object-fit: cover; }
    .image-box.wrong { animation: shake 0.5s; }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-5px); } 40%, 80% { transform: translateX(5px); } }
    .image-box.correct { animation: pop 0.5s; }
    @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
    .controls { display: flex; gap: 15px; margin-bottom: 20px; }
    .btn { padding: 12px 25px; font-size: 1rem; font-weight: bold; border: none; border-radius: 30px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
    .btn:active { transform: translateY(1px); }
    .help-btn { background: var(--primary); color: white; }
    .back-btn { background: #6c757d; color: white; }
    .stars-container { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
    .star { font-size: 1.5rem; color: #ddd; transition: all 0.3s ease; }
    .star.filled { color: var(--accent); text-shadow: 0 0 10px rgba(255, 230, 109, 0.7); animation: twinkle 0.5s ease-in-out; }
    @keyframes twinkle { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
    .results { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(41, 47, 54, 0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; padding: 20px; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
    .results.show { opacity: 1; pointer-events: all; }
    .results-content { background: white; border-radius: 20px; padding: 30px; max-width: 500px; width: 90%; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); transform: scale(0.9); transition: transform 0.3s ease; position: relative; overflow: hidden; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border: 3px solid var(--accent); }
    .results.show .results-content { transform: scale(1); }
    .results h2 { color: var(--primary); margin-bottom: 15px; font-size: 1.8rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
    .results p { font-size: 1.2rem; margin-bottom: 10px; color: var(--dark); }
    .results-stars { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; margin: 15px 0; }
    .result-star { font-size: 1.5rem; color: #ddd; }
    .result-star.filled { color: var(--accent); text-shadow: 0 0 10px rgba(255, 230, 109, 0.7); }
    .next-btn { background: var(--secondary); color: white; margin-top: 20px; font-size: 1.1rem; padding: 15px 30px; }
    .confetti { position: absolute; width: 10px; height: 10px; background-color: var(--accent); opacity: 0; }
    .firework { position: absolute; width: 5px; height: 5px; border-radius: 50%; box-shadow: 0 0 10px 5px rgba(255, 230, 109, 0.7); opacity: 0; }
    .celebration-text { position: absolute; font-size: 1.5rem; font-weight: bold; color: var(--primary); opacity: 0; animation: floatUp 2s ease-out forwards; }
    @keyframes floatUp { 0% { transform: translateY(0) scale(0.5); opacity: 0; } 20% { opacity: 1; } 100% { transform: translateY(-100px) scale(1.5); opacity: 0; } }
    .instructions { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(41, 47, 54, 0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 200; padding: 20px; }
    .instructions-content { background: white; border-radius: 20px; padding: 30px; max-width: 500px; width: 90%; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border: 3px solid var(--primary); }
    .instructions h2 { color: var(--primary); margin-bottom: 20px; font-size: 1.8rem; }
    .instructions p { font-size: 1.1rem; margin-bottom: 15px; color: var(--dark); line-height: 1.6; }
    .start-btn { background: var(--secondary); color: white; margin-top: 20px; font-size: 1.2rem; padding: 15px 40px; border: none; border-radius: 30px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .start-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
    .start-btn:active { transform: translateY(1px); }
    .rating { font-size: 1.5rem; font-weight: bold; margin: 15px 0; padding: 10px; border-radius: 10px; background: rgba(255, 255, 255, 0.7); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .excellent { color: #4CAF50; } .very-good { color: #8BC34A; } .good { color: #FFC107; } .average { color: #FF9800; } .below-average { color: #F44336; }
    .header-content { display: flex; flex-direction: row-reverse; align-items: center; justify-content: space-between; width: 100%; gap: 10px; }
    .header-text { display: flex; flex-direction: column; align-items: flex-end; }
    .timer-container { margin-left: 10px; margin-bottom: 0; width: 70px; height: 70px; }
    @media (max-width: 600px) { h1 { font-size: 1.5rem; } .animal-name { font-size: 1.4rem; } }          
    @media (max-width: 400px) { .images-container { grid-template-columns: repeat(3, 1fr); gap: 10px; } .top-container { flex-direction: row; gap: 10px; min-height: auto;} .top-slot { width: 70px; height: 70px; } }
  </style>
</head>
<body>

  <!-- --- ØªØ¹Ø¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯: Ø²Ø± ÙƒØªÙ… Ø§Ù„ØµÙˆØª --- -->
  <button id="muteBtn" class="mute-btn">
    <i class="fas fa-volume-high"></i>
  </button>
  <!-- --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ --- -->

  <h1><i class="fa-solid fa-paw"></i> Ù„Ø¹Ø¨Ø© ØªØ¬Ù…ÙŠØ¹ ØµÙˆØ± Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª <i class="fa-solid fa-paw"></i></h1>
  
  <div id="roundsScreen" class="screen">
    <h2>Ø§Ø®ØªØ± Ø¬ÙˆÙ„Ø©</h2>
    <div id="roundsContainer"></div>
  </div>

  <div id="gameContainer" class="screen">
    <div class="game-header">
      <div class="header-content">
          <div class="timer-container">
              <div class="timer" id="timer">60</div>
          </div>
          <div class="header-text">
              <div class="animal-name" id="animalName">---</div>
              <div class="level-info">
                  <span>Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <span id="level">1</span></span>
                  <span>Ø§Ù„Ø¬ÙˆÙ„Ø©: <span id="roundDisplay">1</span></span>
              </div>
          </div>
      </div>
    </div>
    <div class="top-container" id="topContainer"></div>
    <div class="images-container" id="imagesContainer"></div>
    <div class="controls">
      <button class="btn help-btn" onclick="showHint()">Ù…Ø³Ø§Ø¹Ø¯Ø© <i class="fa-solid fa-bullseye"></i></button>
      <button class="btn back-btn" onclick="showRoundsScreen()">Ø¹ÙˆØ¯Ø© <i class="fa-solid fa-arrow-left"></i></button>
    </div>
    <div class="stars-container" id="stars"></div>
  </div>
  
  <div class="results" id="results">
    <div class="results-content">
      <h2 id="resultsTitle"></h2>
      <p id="resultsMessage"></p>
      <div class="rating" id="rating"></div>
      <div class="results-stars" id="resultsStars"></div>
      <p>Ø§Ù„Ù†Ø¬ÙˆÙ…: <span id="totalStars">0</span></p>
      <p>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="remainingTime">0</span> Ø«Ø§Ù†ÙŠØ©</p>
      <button class="btn next-btn" id="nextActionBtn"></button>
    </div>
  </div>
  
  <div class="instructions" id="instructions">
    <div class="instructions-content">
      <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© ØªØ¬Ù…ÙŠØ¹ ØµÙˆØ± Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª!</h2>
      <p>ğŸ® Ø£ÙƒÙ…Ù„ 10 Ø¬ÙˆÙ„Ø§Øª Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØŒ ÙƒÙ„ Ø¬ÙˆÙ„Ø© Ø¨Ù‡Ø§ 15 Ù…Ø³ØªÙˆÙ‰.</p>
      <p id="instructionsStarsNeeded"></p> <!-- Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ -->
      <p>ğŸš€ Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„Ù„Ù…ØºØ§Ù…Ø±Ø©ØŸ</p>
      <button class="start-btn" onclick="startAdventure()">Ø¨Ø¯Ø¡ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©! <i class="fa-solid fa-rocket"></i></button>
    </div>
  </div>
  
  <audio id="correctSound" preload="auto" src="https://www.myinstants.com/media/sounds/correct.mp3"></audio>
  <audio id="wrongSound" preload="auto" src="https://www.myinstants.com/media/sounds/wrong.mp3"></audio>
  <audio id="winSound" preload="auto" src="https://www.myinstants.com/media/sounds/success-fanfare-trumpets.mp3"></audio>
  <audio id="levelUpSound" preload="auto" src="https://www.myinstants.com/media/sounds/level-up.mp3"></audio>
  <audio id="celebrationSound" preload="auto" src="https://www.myinstants.com/media/sounds/applause.mp3"></audio>
  <audio id="wrongChoiceSound" preload="auto" src="https://www.myinstants.com/media/sounds/wrong-answer-sound-effect.mp3"></audio>
  
  <script>
    // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ---
    const ROUNDS_COUNT = 10;
    const LEVELS_PER_ROUND = 15;
    const TIME_PER_ROUND = 90;
    // --- ØªØ¹Ø¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯: ØªØ¹Ø±ÙŠÙ Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø¬ÙˆÙ… Ù„Ù„Ù†Ø¬Ø§Ø­ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ ---
    // ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ù†ØµÙ. Math.floor(15 / 2) + 1 = 7 + 1 = 8
    const MIN_STARS_TO_PASS = Math.floor(LEVELS_PER_ROUND / 2) + 1;
    // --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ---

    const masterAnimalList = [
      { name: "Ø£Ø³Ø¯", emoji: "ğŸ¦" }, { name: "Ù†Ù…Ø±", emoji: "ğŸ¯" }, { name: "Ù‚Ø·Ø©", emoji: "ğŸ±" }, { name: "ÙƒÙ„Ø¨", emoji: "ğŸ¶" }, { name: "Ø«Ø¹Ù„Ø¨", emoji: "ğŸ¦Š" },
      { name: "Ø¯Ø¨", emoji: "ğŸ»" }, { name: "Ø¨Ø§Ù†Ø¯Ø§", emoji: "ğŸ¼" }, { name: "ÙƒÙˆØ§Ù„Ø§", emoji: "ğŸ¨" }, { name: "Ø£Ø±Ù†Ø¨", emoji: "ğŸ°" }, { name: "ÙØ£Ø±", emoji: "ğŸ­" },
      { name: "Ù‡Ø§Ù…Ø³ØªØ±", emoji: "ğŸ¹" }, { name: "Ù‚Ø±Ø¯", emoji: "ğŸµ" }, { name: "Ø¯Ø¬Ø§Ø¬Ø©", emoji: "ğŸ”" }, { name: "Ø¨Ø·Ø±ÙŠÙ‚", emoji: "ğŸ§" }, { name: "Ø¶ÙØ¯Ø¹", emoji: "ğŸ¸" },
      { name: "ÙÙŠÙ„", emoji: "ğŸ˜" }, { name: "Ø²Ø±Ø§ÙØ©", emoji: "ğŸ¦’" }, { name: "Ø¬Ù…Ù„", emoji: "ğŸª" }, { name: "Ø¨Ù‚Ø±Ø©", emoji: "ğŸ„" }, { name: "Ø®Ù†Ø²ÙŠØ±", emoji: "ğŸ–" },
      { name: "Ø­ØµØ§Ù†", emoji: "ğŸ" }, { name: "Ø®Ø±ÙˆÙ", emoji: "ğŸ‘" }, { name: "Ø­Ù…Ø§Ø± ÙˆØ­Ø´ÙŠ", emoji: "ğŸ¦“" }, { name: "Ø¯ÙˆÙ„ÙÙŠÙ†", emoji: "ğŸ¬" }, { name: "Ø³Ù…ÙƒØ©", emoji: "ğŸ " },
      { name: "Ø­ÙˆØª", emoji: "ğŸ³" }, { name: "Ø£Ø®Ø·Ø¨ÙˆØ·", emoji: "ğŸ™" }, { name: "Ø¨ÙˆÙ…Ø©", emoji: "ğŸ¦‰" }, { name: "ÙØ±Ø§Ø´Ø©", emoji: "ğŸ¦‹" }, { name: "Ø­Ù„Ø²ÙˆÙ†", emoji: "ğŸŒ" },
      { name: "Ø³Ù†Ø¬Ø§Ø¨", emoji: "ğŸ¿ï¸" }, { name: "ØºØ²Ø§Ù„", emoji: "ğŸ¦Œ" }, { name: "Ø°Ø¦Ø¨", emoji: "ğŸº" }, { name: "Ø®ÙØ§Ø´", emoji: "ğŸ¦‡" }, { name: "Ø¹Ù†ÙƒØ¨ÙˆØª", emoji: "ğŸ•·ï¸" },
      { name: "Ø³Ù„Ø­ÙØ§Ø©", emoji: "ğŸ¢" }, { name: "ØªÙ…Ø³Ø§Ø­", emoji: "ğŸŠ" }, { name: "Ø¯ÙŠÙ†Ø§ØµÙˆØ±", emoji: "ğŸ¦–" }, { name: "ØªÙ†ÙŠÙ†", emoji: "ğŸ‰" }, { name: "Ù†Ø­Ù„Ø©", emoji: "ğŸ" },
      { name: "ØµØ±ØµÙˆØ±", emoji: "ğŸ¦—" }, { name: "Ø·Ø§ÙˆÙˆØ³", emoji: "ğŸ¦š" }, { name: "Ø¨Ø¨ØºØ§Ø¡", emoji: "ğŸ¦œ" }, { name: "Ù†Ø³Ø±", emoji: "ğŸ¦…" }, { name: "Ø¨Ø·Ø©", emoji: "ğŸ¦†" },
      { name: "Ù‚Ù†ÙØ°", emoji: "ğŸ¦”" }, { name: "ÙƒÙ†ØºØ±", emoji: "ğŸ¦˜" }, { name: "Ù„Ø§Ù…Ø§", emoji: "ğŸ¦™" }, { name: "ÙØ±Ø³ Ø§Ù„Ù†Ù‡Ø±", emoji: "ğŸ¦›" }, { name: "ÙˆØ­ÙŠØ¯ Ø§Ù„Ù‚Ø±Ù†", emoji: "ğŸ¦" },
      { name: "ÙÙ‚Ù…Ø©", emoji: "ğŸ¦­" }, { name: "ÙƒØ³Ù„Ø§Ù†", emoji: "ğŸ¦¥" }, { name: "Ø¬Ø±Ø§Ø¯ Ø§Ù„Ø¨Ø­Ø±", emoji: "ğŸ¦" }, { name: "Ø³Ø±Ø·Ø§Ù† Ø§Ù„Ø¨Ø­Ø±", emoji: "ğŸ¦€" }, { name: "Ø¬Ù…Ø¨Ø±ÙŠ", emoji: "ğŸ¦" },
      { name: "Ù‚Ù†Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø±", emoji: " jellyfish" }, { name: "Ø¯ÙˆØ¯Ø©", emoji: "ğŸ›" }, { name: "Ù†Ù…Ù„Ø©", emoji: "ğŸœ" }, { name: "Ø¹Ù‚Ø±Ø¨", emoji: "ğŸ¦‚" }, { name: "ÙÙ„Ø§Ù…Ù†ØºÙˆ", emoji: "ğŸ¦©" },
      { name: "Ø³Ø­Ù„ÙŠØ©", emoji: "ğŸ¦" }, { name: "Ø«Ø¹Ø¨Ø§Ù†", emoji: "ğŸ" }, { name: "ØµÙ‚Ø±", emoji: " Falcon" }, { name: "ØºÙˆØ±ÙŠÙ„Ø§", emoji: "ğŸ¦" }, { name: "ÙÙ‡Ø¯", emoji: "ğŸ†" },
      { name: "Ù†Ù…Ø± Ø£Ø³ÙˆØ¯", emoji: "ğŸˆâ€â¬›" }, { name: "Ù…Ø§Ø¹Ø²", emoji: "ğŸ" }, { name: "Ø¯ÙŠÙƒ Ø±ÙˆÙ…ÙŠ", emoji: "ğŸ¦ƒ" }, { name: "Ø­Ù…Ø§Ù…Ø©", emoji: "ğŸ•Šï¸" }, { name: "Ø£ÙˆØ²Ø©", emoji: "ğŸ¦¢" },
      { name: "Ø±Ø§ÙƒÙˆÙ†", emoji: "ğŸ¦" }, { name: "ÙØ£Ø± ÙƒÙ†ØºØ±", emoji: "ğŸ" }, { name: "ÙØ£Ø± ÙƒØ¨ÙŠØ±", emoji: "ğŸ€" }, { name: "Ù‚Ù†Ø¯Ø³", emoji: "ğŸ¦«" }, { name: "Ø¯ÙˆÙ„Ø§Ø±", emoji: "ğŸ¬" },
      { name: "Ù‚Ù†ÙØ° Ø§Ù„Ø¨Ø­Ø±", emoji: " urchin" }, { name: "Ø­ØµØ§Ù† Ø§Ù„Ø¨Ø­Ø±", emoji: " seahorse" }, { name: "Ù†Ø¬Ù… Ø§Ù„Ø¨Ø­Ø±", emoji: " starfish" }, { name: "ØµØ¯ÙØ©", emoji: "ğŸš" }, { name: "Ù…Ø±Ø¬Ø§Ù†", emoji: " coral" },
      { name: "Ø­Ø´Ø±Ø©", emoji: "ğŸ" }, { name: "ÙŠØ¹Ø³ÙˆØ¨", emoji: " Dragonfly" }, { name: "Ø¨Ø¹ÙˆØ¶Ø©", emoji: " Mosquito" }, { name: "Ø¹Ø«Ø©", emoji: " Moth" }, { name: "ÙƒØ±ÙŠÙƒÙŠØª", emoji: " Cricket" },
      { name: "Ø£Ø³Ø¯ Ø¬Ø¨Ù„ÙŠ", emoji: " Puma" }, { name: "ÙÙ‡Ø¯ ØµÙŠØ§Ø¯", emoji: " Cheetah" }, { name: "Ø¶Ø¨Ø¹", emoji: " Hyena" }, { name: "Ø¬Ø§Ù…ÙˆØ³", emoji: "ğŸƒ" }, { name: "Ø«ÙˆØ±", emoji: "ğŸ‚" },
      { name: "Ø¬Ù…Ù„ Ø°Ùˆ Ø³Ù†Ø§Ù…ÙŠÙ†", emoji: "ğŸ«" }, { name: "Ø¸Ø¨ÙŠ", emoji: " Antelope" }, { name: "Ø¥Ù†Ø³Ø§Ù† Ø§Ù„ØºØ§Ø¨", emoji: "ğŸ¦§" }, { name: "Ø´Ù…Ø¨Ø§Ù†Ø²ÙŠ", emoji: " Chimpanzee" }, { name: "Ù‚Ø· Ø¨Ø±ÙŠ", emoji: " Lynx" },
      { name: "Ø¯Ø¨ Ù‚Ø·Ø¨ÙŠ", emoji: "ğŸ»â€â„ï¸" }, { name: "ÙÙŠÙ„ Ø¢Ø³ÙŠÙˆÙŠ", emoji: " Asian Elephant" }, { name: "Ù…Ø§Ù…ÙˆØ«", emoji: "ğŸ¦£" }, { name: "Ø¨ÙŠØ³ÙˆÙ†", emoji: "ğŸ¦¬" }, { name: "ÙÙŠÙ„ Ø§Ù„Ø¨Ø­Ø±", emoji: " Walrus" },
      { name: "Ø®Ù†Ø²ÙŠØ± Ø¨Ø±ÙŠ", emoji: "ğŸ—" }, { name: "Ø£Ø±Ù…Ø§Ø¯ÙŠÙ„Ùˆ", emoji: " Armadillo" }, { name: "Ø®Ù„Ø¯", emoji: " Mole" }, { name: "Ø¸Ø±Ø¨Ø§Ù†", emoji: " Skunk" }, { name: "ØºØ±ÙŠØ±", emoji: " Badger" },
      { name: "Ø³Ù…ÙˆØ±", emoji: " Otter" }, { name: "ÙƒÙˆØ¬Ø±", emoji: " Cougar" }, { name: "Ø¬Ø§ÙƒÙˆØ§Ø±", emoji: " Jaguar" }, { name: "ÙˆØ´Ù‚", emoji: " Bobcat" }, { name: "ÙƒØ§Ø¨ÙŠØ¨Ø§Ø±Ø§", emoji: " Capybara" },
      { name: "Ù„ÙŠÙ…ÙˆØ±", emoji: " Lemur" }, { name: "Ù…ÙŠØ±ÙƒØ§Øª", emoji: " Meerkat" }, { name: "ÙƒÙˆÙƒØ§", emoji: " Quokka" }, { name: "ÙˆÙ…Ø¨Øª", emoji: " Wombat" }, { name: "ØªØ§Ø¨ÙŠØ±", emoji: " Tapir" },
      { name: "Ø£ÙˆÙƒØ§Ø¨ÙŠ", emoji: " Okapi" }, { name: "Ø¢Ø±Ø¯ÙØ§Ø±Ùƒ", emoji: " Aardvark" }, { name: "Ø¨Ø§Ù†Ø¬ÙˆÙ„ÙŠÙ†", emoji: " Pangolin" }, { name: "Ù†ÙˆØ±Ø³", emoji: " Gull" }, { name: "Ø¨ÙÙ†", emoji: " Puffin" },
      { name: "Ø·ÙˆÙ‚Ø§Ù†", emoji: " Toucan" }, { name: "Ù„Ù‚Ù„Ù‚", emoji: " Stork" }, { name: "ÙƒØ±ÙƒÙŠ", emoji: " Crane" }, { name: "Ø¨Ù„Ø´ÙˆÙ†", emoji: " Heron" }, { name: "ÙƒÙŠÙˆÙŠ", emoji: " Kiwi" },
      { name: "Ù†Ù‚Ø§Ø± Ø§Ù„Ø®Ø´Ø¨", emoji: " Woodpecker" }, { name: "Ø·Ù†Ø§Ù†", emoji: " Hummingbird" }, { name: "Ø±ÙˆØ¨Ù†", emoji: " Robin" }, { name: "Ø¬Ø§ÙŠ", emoji: " Jay" }, { name: "ÙƒØ§Ø±Ø¯ÙŠÙ†Ø§Ù„", emoji: " Cardinal" },
    ];
    
    let allAnimalsData = [];
    const wrongEmojis = ["ğŸ", "âš½ï¸", "ğŸš—", "ğŸ ", "â°", "â¤ï¸", "â­ï¸", "ğŸŒµ", "ğŸ•", "ğŸ¸", "ğŸ’¡", "ğŸ“š", "ğŸ’»", "â˜ï¸", "ğŸ", "ğŸ”‘", "ğŸ’", "âš™ï¸", "ğŸˆ", "â˜‚ï¸", "ğŸŒ", "â˜€ï¸", "ğŸŒ™", "â˜ï¸", "â›„ï¸", "ğŸš²", "âœˆï¸", "ğŸš€", "â›µï¸", "âš“ï¸"];
    let wrongImages = [];

    let currentRoundNumber = 1;
    let currentLevelInRound = 0;
    let levelsForCurrentRound = [];
    let starsInRound = 0;
    let found = 0;
    let timeLeft = TIME_PER_ROUND;
    let interval;
    let unlockedRounds = 1;
    // --- ØªØ¹Ø¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯: Ù…ØªØºÙŠØ± Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª ---
    let isMuted = false;
    // --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ---

    const gameContainer = document.getElementById('gameContainer');
    const roundsScreen = document.getElementById('roundsScreen');
    const resultsScreen = document.getElementById('results');
    
    const correctSound = document.getElementById('correctSound');
    const wrongSound = document.getElementById('wrongSound');
    const winSound = document.getElementById('winSound');
    const levelUpSound = document.getElementById('levelUpSound');
    const celebrationSound = document.getElementById('celebrationSound');

    // --- ØªØ¹Ø¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯: Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØµÙˆØª ---
    function applyMuteState() {
        const muteBtn = document.getElementById('muteBtn');
        const muteIcon = muteBtn.querySelector('i');
        const allAudio = document.querySelectorAll('audio');

        if (isMuted) {
            muteIcon.classList.remove('fa-volume-high');
            muteIcon.classList.add('fa-volume-xmark');
            muteBtn.classList.add('muted');
        } else {
            muteIcon.classList.remove('fa-volume-xmark');
            muteIcon.classList.add('fa-volume-high');
            muteBtn.classList.remove('muted');
        }

        allAudio.forEach(audio => {
            audio.muted = isMuted;
        });
    }

    function toggleMute() {
        isMuted = !isMuted;
        localStorage.setItem('animalGameMuted', isMuted);
        applyMuteState();
    }
    // --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ---

    function createEmojiSVG(emoji, bgColor) {
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
        <rect width='100' height='100' fill='${bgColor}' rx='15'></rect>
        <text x='50' y='65' font-size='60' text-anchor='middle' alignment-baseline='middle'>${emoji}</text>
      </svg>`;
      return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
    }

    function prepareGameData() {
        const bgColors = ["#a8dadc", "#f1faee", "#e63946", "#457b9d", "#1d3557"];
        allAnimalsData = masterAnimalList.map(animal => ({
            name: animal.name,
            correct: Array.from({ length: 3 }, (_, i) => createEmojiSVG(animal.emoji, bgColors[i % bgColors.length]))
        }));
        wrongImages = wrongEmojis.map(emoji => createEmojiSVG(emoji, '#6c757d'));
    }

    function shuffle(array) {
      const newArray = [...array];
      for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
      }
      return newArray;
    }

    function showScreen(screenToShow) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        screenToShow.classList.add('active');
    }

    function startAdventure() {
      document.getElementById('instructions').style.display = 'none';
      showRoundsScreen();
    }
    
    function showRoundsScreen() {
      clearInterval(interval);
      resultsScreen.classList.remove("show");
      unlockedRounds = parseInt(localStorage.getItem('animalGameProgress')) || 1;
      const container = document.getElementById('roundsContainer');
      container.innerHTML = '';

      for (let i = 1; i <= ROUNDS_COUNT; i++) {
        const btn = document.createElement('button');
        btn.className = 'round-btn';
        if (i > unlockedRounds) {
          btn.classList.add('locked');
          btn.innerHTML = `Ø§Ù„Ø¬ÙˆÙ„Ø© ${i}<i class="fas fa-lock"></i>`;
          btn.disabled = true;
        } else {
          btn.innerHTML = `Ø§Ù„Ø¬ÙˆÙ„Ø© ${i}<i class="fas fa-play"></i>`;
          btn.onclick = () => startGame(i);
        }
        container.appendChild(btn);
      }
      showScreen(roundsScreen);
    }
    
    function startGame(roundNum) {
      currentRoundNumber = roundNum;
      currentLevelInRound = 0;
      starsInRound = 0;
      found = 0;
      
      const startIndex = (roundNum - 1) * LEVELS_PER_ROUND;
      const endIndex = startIndex + LEVELS_PER_ROUND;
      levelsForCurrentRound = shuffle(allAnimalsData.slice(startIndex, endIndex));
      
      document.getElementById("stars").innerHTML = '';
      resultsScreen.classList.remove("show");
      timeLeft = TIME_PER_ROUND;
      
      clearInterval(interval);
      interval = setInterval(updateTimer, 1000);
      
      showScreen(gameContainer);
      loadLevel();
    }

    function updateTimer() {
      timeLeft--;
      const timerElement = document.getElementById("timer");
      timerElement.style.setProperty('--time', timeLeft / TIME_PER_ROUND * 100);
      timerElement.textContent = timeLeft;
      
      if (timeLeft <= 10) {
        timerElement.style.color = '#F44336';
        timerElement.style.animation = 'pulse 0.5s infinite';
      } else {
        timerElement.style.color = 'var(--dark)';
        timerElement.style.animation = 'none';
      }
      
      if (timeLeft <= 0) {
        clearInterval(interval);
        showResults(false);
      }
    }

    function loadLevel() {
      const topContainer = document.getElementById("topContainer");
      const imagesContainer = document.getElementById("imagesContainer");
      const animal = levelsForCurrentRound[currentLevelInRound];

      document.getElementById("roundDisplay").textContent = currentRoundNumber;
      document.getElementById("level").textContent = currentLevelInRound + 1;
      document.getElementById("animalName").textContent = animal.name;

      topContainer.innerHTML = "";
      imagesContainer.innerHTML = "";

      animal.correct.forEach(() => {
        const slot = document.createElement("div");
        slot.className = "top-slot";
        topContainer.appendChild(slot);
      });
      
      const selectedWrongImages = shuffle(wrongImages).slice(0, 9);
      const allImages = shuffle([...animal.correct, ...selectedWrongImages]);
      
      allImages.forEach(src => {
        const box = document.createElement("div");
        box.className = "image-box";
        const img = document.createElement("img");
        img.src = src;
        img.alt = "ØµÙˆØ±Ø©";
        img.onclick = () => checkImage(src, box);
        box.appendChild(img);
        imagesContainer.appendChild(box);
      });
    }

    function checkImage(src, box) {
      const animal = levelsForCurrentRound[currentLevelInRound];
      
      if (animal.correct.includes(src)) {
        correctSound.play();
        box.classList.add("correct");
        
        const slot = document.querySelector(".top-slot:not(.filled)");
        if (slot) {
          const img = document.createElement("img");
          img.src = src;
          slot.appendChild(img);
          slot.classList.add("filled");
          box.style.pointerEvents = "none";
          box.style.opacity = "0.5";
          found++;
          
          if (found === animal.correct.length) {
            starsInRound++;
            updateStars();
            
            setTimeout(() => {
              currentLevelInRound++;
              if (currentLevelInRound < LEVELS_PER_ROUND) {
                found = 0;
                levelUpSound.play();
                loadLevel();
              } else {
                clearInterval(interval);
                showResults(true);
              }
            }, 1000);
          }
        }
      } else {
        wrongSound.play();
        box.classList.add("wrong");
        setTimeout(() => box.classList.remove("wrong"), 500);
      }
    }

    function updateStars() {
      const starsContainer = document.getElementById("stars");
      starsContainer.innerHTML = '';
      for (let i = 0; i < starsInRound; i++) {
        starsContainer.innerHTML += '<div class="star filled">â˜…</div>';
      }
    }

    function showHint() {
      if(currentLevelInRound < levelsForCurrentRound.length) {
        alert(`ØªÙ„Ù…ÙŠØ­: Ø§Ø®ØªØ± ØµÙˆØ± ${levelsForCurrentRound[currentLevelInRound].name}`);
      }
    }

    function showResults(completed) {
      const passed = completed && starsInRound >= MIN_STARS_TO_PASS;
      
      document.getElementById("resultsTitle").innerHTML = `Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¬ÙˆÙ„Ø© ${currentRoundNumber} <i class="fa-solid fa-trophy"></i>`;
      document.getElementById("totalStars").textContent = `${starsInRound}/${LEVELS_PER_ROUND}`;
      document.getElementById("remainingTime").textContent = timeLeft > 0 ? timeLeft : 0;
      
      const ratingElement = document.getElementById("rating");
      let ratingText = '';
      if (passed) {
        if (starsInRound === LEVELS_PER_ROUND) { ratingText = 'Ù…Ø«Ø§Ù„ÙŠ! ğŸ‘‘'; ratingElement.className = 'rating excellent'; }
        else if (starsInRound >= 12) { ratingText = 'Ù…Ù…ØªØ§Ø²! â­â­â­â­'; ratingElement.className = 'rating very-good'; }
        else { ratingText = 'Ø¬ÙŠØ¯! â­â­â­'; ratingElement.className = 'rating good'; }
      } else {
        ratingText = 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰! â­'; ratingElement.className = 'rating below-average';
      }
      ratingElement.innerHTML = ratingText;
      
      const nextBtn = document.getElementById("nextActionBtn");
      if (passed) {
        document.getElementById("resultsMessage").textContent = "Ù„Ù‚Ø¯ Ù†Ø¬Ø­Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©!";
        winSound.play();
        createConfetti();
        const nextRound = currentRoundNumber + 1;
        if (nextRound <= ROUNDS_COUNT) {
          unlockedRounds = Math.max(unlockedRounds, nextRound);
          localStorage.setItem('animalGameProgress', unlockedRounds);
          nextBtn.innerHTML = `Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø¬ÙˆÙ„Ø© ${nextRound} <i class="fa-solid fa-arrow-right"></i>`;
          nextBtn.onclick = () => startGame(nextRound);
        } else {
          nextBtn.innerHTML = `Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© <i class="fa-solid fa-home"></i>`;
          nextBtn.onclick = showRoundsScreen;
        }
      } else {
        document.getElementById("resultsMessage").textContent = completed ? `Ù„Ù… ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¬ÙˆÙ… Ø§Ù„ÙƒØ§ÙÙŠØ© (${MIN_STARS_TO_PASS}) Ù„Ù„Ù…Ø±ÙˆØ±.` : "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!";
        nextBtn.innerHTML = `Ø£Ø¹Ø¯ Ù„Ø¹Ø¨ Ø§Ù„Ø¬ÙˆÙ„Ø© ${currentRoundNumber} <i class="fa-solid fa-arrows-rotate"></i>`;
        nextBtn.onclick = () => startGame(currentRoundNumber);
      }
      
      const resultsStars = document.getElementById("resultsStars");
      resultsStars.innerHTML = '';
      for (let i = 0; i < LEVELS_PER_ROUND; i++) {
        resultsStars.innerHTML += `<span class="result-star ${i < starsInRound ? 'filled' : ''}">â˜…</span>`;
      }
      
      resultsScreen.classList.add("show");
    }

    function createConfetti() {
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement("div");
        confetti.className = "confetti";
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
        const animation = confetti.animate([
          { top: '-10px', opacity: 1 },
          { top: '100vh', opacity: 0, transform: `rotate(${Math.random() * 720}deg)` }
        ], { duration: Math.random() * 2000 + 1500, easing: 'ease-out' });
        animation.onfinish = () => confetti.remove();
        document.body.appendChild(confetti);
      }
    }

    window.onload = function() {
      prepareGameData();

      // --- ØªØ¹Ø¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯: Ø¥Ø¹Ø¯Ø§Ø¯ Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ---
      isMuted = localStorage.getItem('animalGameMuted') === 'true';
      applyMuteState();
      document.getElementById('muteBtn').onclick = toggleMute;
      // --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ---
      
      document.getElementById('instructionsStarsNeeded').textContent = `ğŸ’¡ Ø§Ø¬Ù…Ø¹ ${MIN_STARS_TO_PASS} Ù†Ø¬ÙˆÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ÙÙŠ ÙƒÙ„ Ø¬ÙˆÙ„Ø© Ù„ÙØªØ­ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.`;
      document.getElementById('instructions').style.display = 'flex';
    };
  </script>
</body>
</html>