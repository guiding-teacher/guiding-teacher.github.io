<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø±Ø­Ù„Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');

        :root {
            --primary: #f1c40f;
            --secondary: #2980b9;
            --accent: #e74c3c;
            --bg: #ecf0f1;
            --card-bg: #ffffff;
        }

        body {
            margin: 0;
            font-family: 'Tajawal', sans-serif;
            background: var(--bg);
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        header {
            background: white;
            width: 100%;
            padding: 1vh 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-bottom: 4px solid var(--primary);
            flex-shrink: 0;
            position: relative;
            z-index: 10;
        }
        
        h1 { margin: 0; color: var(--secondary); font-size: 1.5rem; }
        p.subtitle { margin: 5px 0 0; color: #7f8c8d; font-weight: bold; font-size: 0.9rem; }

        .progress-container {
            width: 90%; max-width: 600px;
            background: #bdc3c7;
            border-radius: 20px;
            height: 10px;
            margin: 5px auto;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary), #f39c12);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .story-container {
            position: relative;
            margin: 10px;
            background: white;
            padding: 10px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 4px solid white;
            height: auto;
            max-height: 80vh;
            aspect-ratio: 3 / 4.2;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #base-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 15px;
            display: block;
        }

        .story-grid {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 90%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 28px;
            padding: 10px;
            box-sizing: border-box;
        }

        .interactive-zone {
            position: relative;
            border-radius: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.0);
        }

        .interactive-zone:hover {
            background: rgba(255,255,255,0.1);
            box-shadow: inset 0 0 20px rgba(241, 196, 15, 0.4);
            border: 2px solid var(--primary);
        }

        .number-badge {
            position: absolute;
            background: white;
            color: var(--secondary);
            width: 30px; height: 30px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 900;
            font-size: 1.1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            border: 2px solid var(--secondary);
            pointer-events: none;
        }
        .number-badge.done { background: var(--primary); border-color: var(--primary); color: white; }

        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            justify-content: center; align-items: center;
            padding: 15px;
        }

        .story-card {
            background: var(--card-bg);
            width: 100%; max-width: 450px;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            animation: popUp 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .zoomed-view {
            width: 100%; 
            height: 271px;
            background-image: url('/drsne/images/ga14.jpg');
            background-size: 188% 230%;
            background-repeat: no-repeat;
            border-bottom: 5px solid var(--primary);
            position: relative;
            flex-shrink: 0;
        }

        .vocab-card {
            position: absolute;
            top: 15px; right: 15px;
            background: white;
            padding: 5px 12px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transform: rotate(-3deg);
            animation: float 3s infinite ease-in-out;
        }
        .vocab-title { font-size: 0.65rem; color: #95a5a6; font-weight: bold; display: block; }
        .vocab-word { font-size: 1.1rem; color: var(--secondary); font-weight: 900; }

        .speaker-btn {
            position: absolute;
            bottom: -25px; left: 50%;
            transform: translateX(-50%);
            width: 50px; height: 50px;
            background: var(--secondary);
            border-radius: 50%;
            border: 4px solid white;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            z-index: 5;
        }
        .speaker-btn:hover { transform: translateX(-50%) scale(1.1); background: #3498db; }
        .speaker-btn.playing { animation: pulse 1.5s infinite; }

        .content-area { padding: 35px 20px 20px; flex-grow: 1; }

        .story-text {
            font-size: 1rem; color: #2c3e50;
            margin-bottom: 15px; line-height: 1.6;
            font-weight: 600;
            background: #f4f6f7;
            padding: 12px;
            border-radius: 12px;
            border-right: 4px solid var(--primary);
            min-height: 50px;
            display: flex; align-items: center; justify-content: center;
        }

        .options-container { display: grid; gap: 10px; }
        
        .option-btn {
            background: white;
            border: 2px solid #ecf0f1;
            padding: 12px;
            border-radius: 12px;
            font-family: inherit; font-size: 0.95rem; font-weight: bold; color: #555;
            cursor: pointer; transition: 0.2s;
        }
        .option-btn:hover { border-color: var(--secondary); color: var(--secondary); background: #ebf5fb; }
        .option-btn.correct { background: #27ae60; border-color: #27ae60; color: white; }
        .option-btn.wrong { background: #e74c3c; border-color: #e74c3c; color: white; animation: shake 0.5s; }

        .close-btn {
            position: absolute; top: 10px; left: 10px;
            background: #e74c3c; color: white;
            width: 32px; height: 32px; border-radius: 50%; border: 2px solid white;
            cursor: pointer; font-weight: bold; font-size: 1.2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 10;
            display: flex; align-items: center; justify-content: center;
        }

        .victory-screen {
            position: fixed; inset: 0;
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            z-index: 3000; display: none;
            flex-direction: column; justify-content: center; align-items: center;
            color: white; text-align: center;
            animation: fadeIn 0.5s;
        }
        .victory-icon { font-size: 6rem; margin-bottom: 20px; animation: bounce 2s infinite; }
        .victory-btn {
            margin-top: 30px; padding: 15px 50px;
            background: white; color: #d35400;
            border: none; border-radius: 50px;
            font-size: 1.3rem; font-weight: 900;
            cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        @keyframes popUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes float { 0%, 100% { transform: rotate(-3deg) translateY(0); } 50% { transform: rotate(-3deg) translateY(-5px); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(41, 128, 185, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(41, 128, 185, 0); } 100% { box-shadow: 0 0 0 0 rgba(41, 128, 185, 0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    </style>
</head>
<body>

    <header>
        <h1>ğŸ’ Ø±Ø­Ù„Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</h1>
        <div class="progress-container">
            <div class="progress-bar" id="progBar"></div>
        </div>
        <p class="subtitle" id="progText">0 / 4 Ù…Ø±Ø§Ø­Ù„ Ù…ÙƒØªÙ…Ù„Ø©</p>
    </header>

    <div class="story-container">
        <img src="/drsne/images/ga14.jpg" id="base-image" alt="Ù‚ØµØ© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©">
        
        <div class="story-grid">
            <!-- 1: Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
            <div class="interactive-zone" style="grid-column: 2; grid-row: 1;" onclick="openScene(1)">
                <div class="number-badge" id="badge-1" style="bottom: 10px; left: 10px;">1</div>
            </div>

            <!-- 2: Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± -->
            <div class="interactive-zone" style="grid-column: 1; grid-row: 1;" onclick="openScene(2)">
                <div class="number-badge" id="badge-2" style="bottom: 10px; right: 10px;">2</div>
            </div>

            <!-- 3: Ø£Ø³ÙÙ„ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
            <div class="interactive-zone" style="grid-column: 2; grid-row: 2;" onclick="openScene(3)">
                <div class="number-badge" id="badge-3" style="top: 10px; left: 10px;">3</div>
            </div>

            <!-- 4: Ø£Ø³ÙÙ„ Ø§Ù„ÙŠØ³Ø§Ø± -->
            <div class="interactive-zone" style="grid-column: 1; grid-row: 2;" onclick="openScene(4)">
                <div class="number-badge" id="badge-4" style="top: 10px; right: 10px;">4</div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal">
        <div class="story-card">
            <button class="close-btn" onclick="closeModal()">âœ•</button>
            
            <div class="zoomed-view" id="zoomedImg">
                <div class="vocab-card">
                    <span class="vocab-title">ØªØ¹Ù„Ù… ÙƒÙ„Ù…Ø©:</span>
                    <span class="vocab-word" id="vocabWord">...</span>
                </div>
                <button class="speaker-btn" onclick="playAudio()" id="speakerIcon">ğŸ”Š</button>
            </div>

            <div class="content-area">
                <div class="story-text" id="storyText">...</div>
                <h4 style="margin: 0 0 10px; color: #7f8c8d; font-size: 0.9rem;">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</h4>
                <div class="options-container" id="optionsBox"></div>
            </div>
        </div>
    </div>

    <div class="victory-screen" id="victoryScreen">
        <div class="victory-icon">ğŸšŒ</div>
        <h1 style="font-size: 2rem;">ÙˆØµÙ„Ù†Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©!</h1>
        <p style="font-size: 1.2rem;">Ø£Ø­Ø³Ù†Øª ÙŠØ§ Ø¨Ø·Ù„ØŒ Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù‚ØµØ© Ø¨Ù†Ø¬Ø§Ø­</p>
        <button class="victory-btn" onclick="location.reload()">Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>
    </div>

    <canvas id="confettiCanvas" style="position:fixed; top:0; left:0; pointer-events:none; z-index:3000;"></canvas>

    <script>
        // ØªÙ… ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚ÙŠÙ… Ù„Ø¹ÙƒØ³ Ø£Ù…Ø§ÙƒÙ† Ø§Ù„ØµÙˆØ± ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
        // 0% = Ø§Ù„ÙŠØ³Ø§Ø±
        // 100% = Ø§Ù„ÙŠÙ…ÙŠÙ†
        const scenes = {
            1: {
                id: 1,
                // ÙƒØ§Ù† 100% 0% - Ø£ØµØ¨Ø­ 0% 0% (Ù„ÙŠØ£Ø®Ø° Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„ÙŠØ³Ø±Ù‰ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„ÙŠÙ…Ù†Ù‰)
                bgPos: '0% 0%', 
                vocab: 'Ø£Ù…ÙŠ',
                text: "ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­ Ø§Ù„Ø¨Ø§ÙƒØ±ØŒ Ø§Ø±ØªØ¯Øª Ø³Ø§Ø±Ø© Ø²ÙŠ Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ÙˆÙˆØ¯Ø¹Øª Ø£Ù…Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø§Ø¨ Ù‚Ø§Ø¦Ù„Ø©: Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ÙŠØ§ Ø£Ù…ÙŠ Ø§Ù„Ø­Ø¨ÙŠØ¨Ø©.",
                options: [
                    { txt: "Ø³Ø§Ø±Ø© ØªÙˆØ¯Ø¹ Ø£Ù…Ù‡Ø§", correct: true },
                    { txt: "Ø³Ø§Ø±Ø© ØªÙ„Ø¹Ø¨ Ø¨Ø§Ù„ÙƒØ±Ø©", correct: false },
                    { txt: "Ø³Ø§Ø±Ø© Ù†Ø§Ø¦Ù…Ø©", correct: false }
                ]
            },
            2: {
                id: 2,
                // ÙƒØ§Ù† 0% 0% - Ø£ØµØ¨Ø­ 100% 0%
                bgPos: '100% 0%', 
                vocab: 'ØµØ¯ÙŠÙ‚ØªÙŠ',
                text: "Ø®Ø±Ø¬Øª Ø³Ø§Ø±Ø© Ù…Ù† Ø§Ù„Ø¯Ø§Ø±ØŒ ÙˆÙ‚Ø§Ø¨Ù„Øª ØµØ¯ÙŠÙ‚ØªÙ‡Ø§ Ù„ÙŠÙ„Ù‰ ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚. ÙØ±Ø­Øª Ø§Ù„ØµØ¯ÙŠÙ‚ØªØ§Ù† Ø¨Ø§Ù„Ù„Ù‚Ø§Ø¡ ÙˆÙ‚Ø§Ù„ØªØ§: ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±!",
                options: [
                    { txt: "Ù‚Ø§Ø¨Ù„Øª Ø³Ø§Ø±Ø© Ø§Ù„Ø´Ø±Ø·ÙŠ", correct: false },
                    { txt: "Ù‚Ø§Ø¨Ù„Øª Ø³Ø§Ø±Ø© ØµØ¯ÙŠÙ‚ØªÙ‡Ø§ Ù„ÙŠÙ„Ù‰", correct: true },
                    { txt: "Ø³Ø§Ø±Ø© ØªÙ…Ø´ÙŠ ÙˆØ­ÙŠØ¯Ø©", correct: false }
                ]
            },
            3: {
                id: 3,
                // ÙƒØ§Ù† 100% 100% - Ø£ØµØ¨Ø­ 0% 100%
                bgPos: '0% 100%', 
                vocab: 'Ø¬Ø§Ø±Ù†Ø§',
                text: "Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø´ÙŠØŒ Ø´Ø§Ù‡Ø¯Øª Ø§Ù„Ø¨Ù†ØªØ§Ù† Ø¬Ø§Ø±Ù‡Ù…Ø§ Ø£Ø­Ù…Ø¯ ÙŠØ­Ù…Ù„ Ø­Ù‚ÙŠØ¨ØªÙ‡. Ø§Ù†Ø¶Ù… Ø£Ø­Ù…Ø¯ Ø¥Ù„ÙŠÙ‡Ù…Ø§ Ù„ÙŠÙ…Ø´ÙˆØ§ Ù…Ø¹Ø§Ù‹ Ø¨Ù†Ø´Ø§Ø·.",
                options: [
                    { txt: "Ø£Ø­Ù…Ø¯ ÙŠÙ„Ø¹Ø¨ ÙÙŠ Ø§Ù„Ø­Ø¯ÙŠÙ‚Ø©", correct: false },
                    { txt: "Ø£Ø­Ù…Ø¯ ÙŠØ±ÙƒØ¨ Ø§Ù„Ø³ÙŠØ§Ø±Ø©", correct: false },
                    { txt: "Ø§Ù†Ø¶Ù… Ø§Ù„Ø¬Ø§Ø± Ø£Ø­Ù…Ø¯ Ø¥Ù„ÙŠÙ‡Ù…Ø§", correct: true }
                ]
            },
            4: {
                id: 4,
                // ÙƒØ§Ù† 0% 100% - Ø£ØµØ¨Ø­ 100% 100%
                bgPos: '100% 100%', 
                vocab: 'Ø§Ù„Ù…Ø¯Ø±Ø³Ø©',
                text: "Ø³Ø§Ø± Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ù…Ø¹Ø§Ù‹ ÙÙŠ Ù†Ø¸Ø§Ù… ÙˆØ§Ø­ØªØ±Ø§Ù…ØŒ Ø­ØªÙ‰ ÙˆØµÙ„ÙˆØ§ Ø¥Ù„Ù‰ Ù…Ø¯Ø±Ø³ØªÙ‡Ù… Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯.",
                options: [
                    { txt: "Ø°Ù‡Ø¨ÙˆØ§ Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙˆÙ‚", correct: false },
                    { txt: "ÙˆØµÙ„ÙˆØ§ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø¨Ø§Ù†ØªØ¸Ø§Ù…", correct: true },
                    { txt: "Ø¹Ø§Ø¯ÙˆØ§ Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙŠØª", correct: false }
                ]
            }
        };

        let currentScene = null;
        let completedCount = 0;
        let completedIds = new Set();

        function openScene(id) {
            currentScene = scenes[id];
            const modal = document.getElementById('modal');
            
            document.getElementById('zoomedImg').style.backgroundPosition = currentScene.bgPos;
            
            document.getElementById('vocabWord').innerText = currentScene.vocab;
            document.getElementById('storyText').innerText = "Ø§Ø³ØªÙ…Ø¹ Ù„Ù„Ù‚ØµØ©...";
            
            const spk = document.getElementById('speakerIcon');
            spk.classList.remove('playing');

            speak(currentScene.text);

            const optsBox = document.getElementById('optionsBox');
            optsBox.innerHTML = '';
            
            let opts = [...currentScene.options].sort(() => Math.random() - 0.5);
            
            opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt.txt;
                btn.onclick = () => checkAnswer(btn, opt.correct, id);
                optsBox.appendChild(btn);
            });

            modal.style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            window.speechSynthesis.cancel();
        }

        function checkAnswer(btn, isCorrect, id) {
            if(isCorrect) {
                btn.classList.add('correct');
                speak("Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©ØŒ Ø£Ø­Ø³Ù†Øª!");
                
                if(!completedIds.has(id)) {
                    completedIds.add(id);
                    completedCount++;
                    document.getElementById(`badge-${id}`).classList.add('done');
                    updateProgress();
                    fireConfetti(false);
                }
                
                setTimeout(closeModal, 2000);
            } else {
                btn.classList.add('wrong');
                speak("Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰");
            }
        }

        function updateProgress() {
            const pct = (completedCount / 4) * 100;
            document.getElementById('progBar').style.width = pct + '%';
            document.getElementById('progText').innerText = `${completedCount} / 4 Ù…Ø±Ø§Ø­Ù„ Ù…ÙƒØªÙ…Ù„Ø©`;

            if(completedCount === 4) {
                setTimeout(() => {
                    speak("Ø£Ø­Ø³Ù†Øª ÙŠØ§ Ø¨Ø·Ù„! Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©.");
                    document.getElementById('victoryScreen').style.display = 'flex';
                    fireConfetti(true);
                }, 1000);
            }
        }

        // =========================================================
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„Ù…ÙˆØ­Ø¯Ø© (ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ§Ù„Ù…ØªØµÙØ­)
        // =========================================================
        function speak(text) {
            // 1. Ø§Ù„ØªØ­Ù‚Ù‚: Ù‡Ù„ Ù†Ø­Ù† Ø¯Ø§Ø®Ù„ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ØŸ
            if (typeof Android !== 'undefined' && Android.speakArabic) {
                // Ù†Ø¹Ù…: Ø§Ø³ØªØ®Ø¯Ù… Ù†Ø§Ø·Ù‚ Ø§Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ (Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© + ÙŠØ¹Ù…Ù„ Ø£ÙˆÙÙ„Ø§ÙŠÙ†)
                Android.speakArabic(text);
            } else {
                // Ù„Ø§: Ù†Ø­Ù† ÙÙŠ Ù…ØªØµÙØ­ ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø¹Ø§Ø¯ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù†Ø§Ø·Ù‚ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
                if (window.speechSynthesis) {
                    speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'ar-SA';
                    utterance.rate = 0.9; // Ø³Ø±Ø¹Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
                    utterance.pitch = 1.0; // Ù†Ø¨Ø±Ø© Ø§Ù„ØµÙˆØª
                    speechSynthesis.speak(utterance);
                }
            }
        }

        function playAudio() {
            if(currentScene) speak(currentScene.text);
        }

        const canvas = document.getElementById('confettiCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.onresize = resizeCanvas;
        resizeCanvas();

        function fireConfetti(big) {
            const count = big ? 300 : 60;
            for(let i=0; i<count; i++) {
                particles.push({
                    x: canvas.width / 2,
                    y: big ? canvas.height : canvas.height/2,
                    vx: (Math.random() - 0.5) * (big ? 25 : 15),
                    vy: (Math.random() - (big ? 1 : 0.5)) * 20,
                    c: `hsl(${Math.random()*360}, 100%, 50%)`,
                    size: Math.random() * 10 + 5,
                    life: 150
                });
            }
            loop();
        }

        function loop() {
            if(particles.length === 0) return;
            ctx.clearRect(0,0,canvas.width, canvas.height);
            
            for(let i=0; i<particles.length; i++) {
                let p = particles[i];
                p.x += p.vx; p.y += p.vy; p.vy += 0.4; p.life--;
                ctx.fillStyle = p.c;
                ctx.fillRect(p.x, p.y, p.size, p.size);
                
                if(p.life <= 0 || p.y > canvas.height) {
                    particles.splice(i, 1);
                    i--;
                }
            }
            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>